{"version":3,"file":"keet-bundle.js","sources":["src/components/templateParse/updateState.js","src/components/conditionalNodes.js","src/components/templateParse/conditionalCache.js","src/components/genModelList.js","utils.js","src/components/componentParse.js","src/components/templateParse/replaceCommentBlock.js","src/components/ternaryOps.js","src/components/strInterpreter.js","src/components/templateParse/valAssign.js","src/components/templateParse/replaceHandleBars.js","src/components/templateParse/inspectAttributes.js","src/components/templateParse/addEvent.js","src/components/templateParse/reconcile.js","src/components/templateParse/diffNodes.js","src/components/genElement.js","src/components/parseStr.js","src/base/createModel.js","src/base/mount.js","keet.js"],"sourcesContent":["export default function (state, updateStateList) {\r\n  if (typeof updateStateList === 'function') updateStateList(state)\r\n}\r\n","const conditionalNodesRawEnd = /\\{\\{\\/([^{}]+)\\}\\}/g\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\nconst DOCUMENT_COMMENT_TYPE = 8\r\n\r\nlet cache = {}\r\n\r\n// rebuild the node structure\r\nfunction catchNode (node, start) {\r\n  let cNode\r\n  while (node) {\r\n    cNode = node\r\n    node = node.nextSibling\r\n    if (cNode && cNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n      if (cNode.isEqualNode(start)) {\r\n        cNode.remove()\r\n        start = start.nextSibling\r\n      } else {\r\n        catchNode(cNode.firstChild, start)\r\n      }\r\n    } else if (cNode.isEqualNode(start)) {\r\n      cNode.remove()\r\n      start = start.nextSibling\r\n    }\r\n  }\r\n}\r\n\r\nfunction resolveConditionalNodes (node, conditional, setup, runner, addState) {\r\n  let currentNode\r\n  let cNode\r\n  let fetchFrag\r\n  let frag = document.createDocumentFragment()\r\n  if (setup === 'initial' && !cache.hasOwnProperty(conditional)) {\r\n    cNode = node\r\n    while (cNode) {\r\n      currentNode = cNode\r\n      cNode = cNode.nextSibling\r\n      if (currentNode.nodeType !== DOCUMENT_ELEMENT_TYPE && currentNode.nodeValue.match(conditionalNodesRawEnd)) {\r\n        cNode = null\r\n        cache[conditional] = cache[conditional] || {}\r\n        // clean up pristine node\r\n        catchNode(this.__pristineFragment__.firstChild, frag.firstChild)\r\n        // since we work backward no need to check fragment recursive conditional states\r\n        cache[conditional].frag = frag\r\n      } else if (currentNode.nodeType !== DOCUMENT_COMMENT_TYPE) {\r\n        frag.appendChild(currentNode)\r\n      }\r\n    }\r\n  } else if (setup === 'conditional-set') {\r\n    if (node.nextSibling.isEqualNode(cache[conditional].frag.firstChild)) return\r\n    fetchFrag = cache[conditional].frag.cloneNode(true)\r\n    runner.call(this, fetchFrag.firstChild, addState)\r\n    node.parentNode.insertBefore(fetchFrag, node.nextSibling)\r\n  }\r\n}\r\n\r\nexport {\r\n  resolveConditionalNodes as default,\r\n  cache\r\n}\r\n","import updateState from './updateState'\r\nimport conditionalNodes from '../conditionalNodes'\r\n\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\nconst DOCUMENT_COMMENT_TYPE = 8\r\nconst conditionalNodesRawStart = /\\{\\{\\?([^{}]+)\\}\\}/g\r\nconst reConditional = /([^{?])(.*?)(?=\\}\\})/g\r\n\r\nlet conditional\r\nlet currentNode\r\nlet state\r\nlet nodes\r\n\r\nfunction check (node) {\r\n  while (node) {\r\n    currentNode = node\r\n    node = node.nextSibling\r\n    if (currentNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n      check.call(this, currentNode.firstChild)\r\n    } else if (currentNode.nodeType === DOCUMENT_COMMENT_TYPE && currentNode.nodeValue.match(conditionalNodesRawStart)) {\r\n      conditional = currentNode.nodeValue.trim().match(reConditional)\r\n      state = state.concat(conditional)\r\n      nodes = nodes.concat(currentNode)\r\n    }\r\n  }\r\n}\r\n\r\nfunction conditionalCache (addState) {\r\n  state = []\r\n  nodes = []\r\n  check.call(this, this.base.firstChild)\r\n  let i = state.length\r\n  while (i > 0) {\r\n    i--\r\n    updateState(state[i], addState.bind(this))\r\n    conditionalNodes.call(this, nodes[i], state[i], 'initial')\r\n  }\r\n}\r\n\r\nexport default conditionalCache\r\n","\r\n// storage for model state\r\nlet cache = {}\r\n\r\nfunction removeProtoModel (node, id) {\r\n  let p = node.getElementById(id)\r\n  if (p) p.childNodes[1].remove()\r\n}\r\n\r\nfunction genModelList (node, model, reconcile) {\r\n  let modelList\r\n  let i\r\n  let listClone\r\n  let parentNode\r\n  let list\r\n  let listArg\r\n  let mLength\r\n\r\n  cache[model] = cache[model] || {}\r\n\r\n  // check if the model use filtering\r\n  listArg = this[model] && this[model].enableFiltering ? 'listFilter' : 'list'\r\n\r\n  if (!cache[model][listArg]) {\r\n    cache[model][listArg] = node.nextSibling.cloneNode(true)\r\n    node.nextSibling.remove()\r\n    // also remove from pristine nodes / conditional cache store\r\n    removeProtoModel(this.__pristineFragment__, node.parentNode.id)\r\n  }\r\n\r\n  list = cache[model][listArg]\r\n\r\n  if (this[model] !== undefined && this[model].hasOwnProperty(listArg)) {\r\n    parentNode = node.parentNode\r\n\r\n    modelList = this[model][listArg]\r\n\r\n    if (!this[model].dirty) {\r\n      parentNode.setAttribute('pristine-model', '')\r\n      return\r\n    }\r\n\r\n    i = 0\r\n\r\n    mLength = modelList.length\r\n\r\n    while (i < mLength) {\r\n      listClone = list.cloneNode(true)\r\n      reconcile.call(this, listClone, null, modelList[i])\r\n      listClone.setAttribute('kdata-id', modelList[i]['kdata-id'])\r\n      parentNode.insertBefore(listClone, parentNode.lastChild)\r\n      i++\r\n    }\r\n    this[model].dirty = false\r\n  }\r\n}\r\n\r\nexport default genModelList\r\n","const genId = () => {\r\n  const rd = () => (Math.random() * 1 * 1e17).toString(36)\r\n  return `KDATA-${rd()}-${rd()}`\r\n}\r\n\r\nconst minId = () => (Math.random() * 1 * 1e17).toString(36)\r\n\r\nconst getId = id => document.getElementById(id)\r\n\r\n/**\r\n * @private\r\n * @description\r\n * Check a node availability in 100ms, if not found silenty skip the event\r\n * or execute a callback\r\n *\r\n * @param {string} id - the node id\r\n * @param {function} callback - the function to execute on success\r\n * @param {function} notFound - the function to execute on failed\r\n */\r\nconst checkNodeAvailability = (component, componentName, callback, notFound) => {\r\n  let ele = getId(component.el)\r\n  let found = false\r\n  let t\r\n  function find () {\r\n    ele = getId(component.el)\r\n    if (ele) {\r\n      clearInterval(t)\r\n      found = true\r\n      callback(component, componentName, ele)\r\n    }\r\n  }\r\n  function fail () {\r\n    clearInterval(t)\r\n    if (!found && notFound && typeof notFound === 'function') notFound()\r\n  }\r\n  if (ele) return ele\r\n  else {\r\n    t = setInterval(find, 0)\r\n    // ignore finding the node after sometimes\r\n    setTimeout(fail, 5)\r\n  }\r\n}\r\n\r\n/**\r\n * @private\r\n * @description\r\n * Confirm that a value is truthy, throws an error message otherwise.\r\n *\r\n * @param {*} val - the val to test.\r\n * @param {string} msg - the error message on failure.\r\n * @throws {Error}\r\n */\r\nconst assert = (val, msg) => {\r\n  if (!val) throw new Error('(keet) ' + msg)\r\n}\r\n\r\n/**\r\n * @private\r\n * @description\r\n * Simple html template literals MODIFIED from : http://2ality.com/2015/01/template-strings-html.html\r\n * by Dr. Axel Rauschmayer\r\n * no checking for wrapping in root element\r\n * no strict checking\r\n * remove spacing / indentation\r\n * keep all spacing within html tags\r\n * include handling ${} in the literals\r\n */\r\nconst html = (...args) => {\r\n  const literals = args.shift()\r\n  const substs = args.slice()\r\n\r\n  let result = literals.raw.reduce((acc, lit, i) => acc + substs[i - 1] + lit)\r\n  // remove spacing, indentation from every line\r\n  result = result.split(/\\n+/)\r\n  result = result.map(t => t.trim()).join('')\r\n  return result\r\n}\r\n\r\nexport {\r\n  html,\r\n  assert,\r\n  checkNodeAvailability,\r\n  genId,\r\n  getId,\r\n  minId\r\n}\r\n","import { assert, getId } from '../../utils'\r\n\r\nlet cacheInit = {}\r\n\r\nfunction getKeetGlobalComponent(component) {\r\n  if (window && typeof window.__keetGlobalComponentRef__ === 'object') {\r\n    return window.__keetGlobalComponentRef__[component]\r\n  }\r\n  return\r\n}\r\n\r\nexport default function (componentStr, node) {\r\n  const component = componentStr.replace('component:', '')\r\n  const c = this[component] || getKeetGlobalComponent(component)\r\n  if (c !== undefined) {\r\n    // this is for initial component runner\r\n    if (!cacheInit[c.ID]) {\r\n      c.render(true)\r\n      cacheInit[c.ID] = c.base.cloneNode(true)\r\n      node.parentNode.replaceChild(c.base, node)\r\n    } else {\r\n      // we need to reattach event listeners if the node is not available on DOM\r\n      if (!getId(c.el)) {\r\n        c.base = c.__pristineFragment__.cloneNode(true)\r\n        c.render(true)\r\n        node.parentNode.replaceChild(c.base, node)\r\n      } else {\r\n        node.parentNode.replaceChild(cacheInit[c.ID].cloneNode(true), node)\r\n        // inform sub-component to update\r\n        c.callBatchPoolUpdate()\r\n      }\r\n    }\r\n  } else {\r\n    assert(false, 'Component ' + component + ' does not exist.')\r\n  }\r\n}\r\n","import genModelList from '../genModelList'\r\nimport componentParse from '../componentParse'\r\n\r\nconst re = /{{([^{}]+)}}/g\r\nconst model = /^model:/g\r\nconst component = /^component:([^{}]+)/g\r\n\r\nexport default function (value, node, reconcile) {\r\n  let rep\r\n  let modelRep\r\n\r\n  if (value.match(re)) {\r\n    rep = value.replace(re, '$1').trim()\r\n    if (rep.match(model)) {\r\n      modelRep = rep.replace('model:', '')\r\n      genModelList.call(this, node, modelRep, reconcile)\r\n    } else if (rep.match(component)) {\r\n      componentParse.call(this, rep, node)\r\n    }\r\n  }\r\n}\r\n","// function to resolve ternary operation\r\n\r\nconst test = str => str === '\\'\\'' || str === '\"\"' || str === 'null' ? '' : str\r\n\r\nexport default function (input) {\r\n  if (input.match(/([^?]*)\\?([^:]*):([^;]*)|(\\s*=\\s*)[^;]*/g)) {\r\n    let t = input.split('?')\r\n    let condition = t[0]\r\n    let leftHand = t[1].split(':')[0]\r\n    let rightHand = t[1].split(':')[1]\r\n\r\n    // check the condition fulfillment\r\n\r\n    if (this) {\r\n      if (this[condition]) {\r\n        return {\r\n          value: test(leftHand),\r\n          state: condition\r\n        }\r\n      } else {\r\n        return {\r\n          value: test(rightHand),\r\n          state: condition\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  } else return false\r\n}\r\n","export default (str) => {\r\n  let res = str.match(/\\.*\\./g)\r\n  let result\r\n  if (res && res.length > 0) {\r\n    return str.split('.')\r\n  }\r\n  return result\r\n}\r\n","export default function (node, value, replace, withTo) {\r\n  let re = new RegExp(replace, 'g')\r\n  node.nodeValue = node.nodeValue.replace(re, withTo)\r\n}\r\n","import ternaryOps from '../ternaryOps'\r\nimport strInterpreter from '../strInterpreter'\r\nimport updateState from './updateState'\r\nimport valAssign from './valAssign'\r\n\r\nconst re = /{{([^{}]+)}}/g\r\n\r\nexport default function (value, node, addState, isAttr, model) {\r\n  const props = value.match(re)\r\n  if (!props) return\r\n  let ln = props.length\r\n  let rep\r\n  let tnr\r\n  let isObjectNotation\r\n\r\n  let self = this\r\n\r\n  let ref = model || this\r\n\r\n  while (ln) {\r\n    ln--\r\n    rep = props[ln].replace(re, '$1')\r\n    tnr = ternaryOps.call(ref, rep)\r\n    isObjectNotation = strInterpreter(rep)\r\n    if (isObjectNotation) {\r\n      if (!isAttr) {\r\n        if (isObjectNotation[0] === 'this' && self[isObjectNotation[1]] !== undefined && typeof self[isObjectNotation[1]] === 'function') {\r\n          let result = self[isObjectNotation[1]]()\r\n          if (result !== undefined) {\r\n            valAssign(node, value, '{{' + rep + '}}', result)\r\n          }\r\n        } else {\r\n          updateState(rep, addState)\r\n          valAssign(node, value, '{{' + rep + '}}', self[isObjectNotation[0]][isObjectNotation[1]])\r\n        }\r\n      } else {\r\n        if (isObjectNotation[0] === 'this' && self[isObjectNotation[1]] !== undefined && typeof self[isObjectNotation[1]] === 'function') {\r\n          let result = self[isObjectNotation[1]](ref)\r\n          return result !== undefined ? result : value\r\n        } else {\r\n          updateState(rep, addState)\r\n          return value.replace(props, self[isObjectNotation[0]][isObjectNotation[1]])\r\n        }\r\n      }\r\n    } else {\r\n      if (tnr) {\r\n        updateState(tnr.state, addState)\r\n        if (!isAttr) {\r\n          valAssign(node, value, '{{' + rep + '}}', tnr.value)\r\n        } else {\r\n          return value.replace(props, tnr.value)\r\n        }\r\n      } else {\r\n        if (ref[rep] !== undefined) {\r\n          updateState(rep, addState)\r\n          if (!isAttr) {\r\n            valAssign(node, value, '{{' + rep + '}}', ref[rep])\r\n          } else {\r\n            return value.replace(props, ref[rep])\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import replaceHandleBars from './replaceHandleBars'\r\n\r\nconst re = /{{([^{}]+)}}/g\r\n\r\nfunction inspectAttributes (node, addState, model) {\r\n  let nodeAttributes = node.attributes\r\n  let i = 0\r\n  let a\r\n  let ns\r\n  let name\r\n\r\n  for (i = nodeAttributes.length; i--;) {\r\n    a = nodeAttributes[i]\r\n    name = a.localName\r\n    ns = a.nodeValue\r\n    if (re.test(name)) {\r\n      node.removeAttribute(name)\r\n      name = replaceHandleBars.call(this, name, node, addState, true, model)\r\n      node.setAttribute(name, ns)\r\n    } else if (re.test(ns)) {\r\n      ns = replaceHandleBars.call(this, ns, node, addState, true, model)\r\n      if (name === 'checked') {\r\n        if (ns === '') {\r\n          node.removeAttribute(name)\r\n          // node.checked = false\r\n        } else {\r\n          // node.checked = true\r\n          node.setAttribute(name, '')\r\n        }\r\n        // node.removeAttribute(name)\r\n      } else {\r\n        if (ns === '') {\r\n          node.setAttribute(name, '')\r\n        } else {\r\n          node.setAttribute(name, ns)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default inspectAttributes\r\n","const DOCUMENT_ELEMENT_TYPE = 1\r\nconst re = /{{([^{}]+)}}/g\r\n\r\nfunction lookupParentNode (rootNode, node) {\r\n  let cNode\r\n  while (node) {\r\n    cNode = node\r\n    node = node.parentNode\r\n    if (cNode.nodeType === DOCUMENT_ELEMENT_TYPE && cNode.hasAttribute('kdata-id')) {\r\n      return { id: cNode.getAttribute('kdata-id'), node: cNode }\r\n    }\r\n    if (cNode.isEqualNode(rootNode)) {\r\n      node = null\r\n    }\r\n  }\r\n}\r\n\r\nconst getIndex = (id, model) => model.list.map(m => m['kdata-id']).indexOf(id)\r\n\r\nfunction addEvent (node, evtData) {\r\n  // delete evtData.isModel\r\n  let evtName = Object.keys(evtData)[0]\r\n  let handler = evtData[evtName]\r\n  if (this[handler] !== undefined && typeof this[handler] === 'function') {\r\n    node.addEventListener(evtName, this[handler].bind(this), !!evtData['useCapture'])\r\n  }\r\n}\r\n\r\nfunction fn (model, handler, node, e) {\r\n  e.stopPropagation()\r\n  if (e.target !== e.currentTarget) {\r\n    let t = lookupParentNode(node, e.target)\r\n    this[handler](model.list[getIndex(t.id, model)], e.target, t.node, e)\r\n  }\r\n}\r\n\r\nfunction addEventModel (node, evtData) {\r\n  // delete evtData.isModel\r\n  let evtName = Object.keys(evtData)[0]\r\n  let handler = evtData[evtName]\r\n  if (this[handler] !== undefined && typeof this[handler] === 'function') {\r\n    let rep = node.firstChild.nodeValue.replace(re, '$1').trim()\r\n    rep = rep.replace('model:', '')\r\n    let model = this[rep]\r\n    node.addEventListener(evtName, fn.bind(this, model, handler, node), !!evtData['useCapture'])\r\n  }\r\n}\r\n\r\nexport {\r\n  addEvent,\r\n  addEventModel\r\n}\r\n","import replaceCommentBlock from './replaceCommentBlock'\r\nimport inspectAttributes from './inspectAttributes'\r\nimport replaceHandleBars from './replaceHandleBars'\r\nimport conditionalNodes from '../conditionalNodes'\r\n\r\nimport { getId } from '../../../utils'\r\nimport { addEvent, addEventModel } from './addEvent'\r\n\r\nconst conditionalNodesRawStart = /\\{\\{\\?([^{}]+)\\}\\}/g\r\nconst reConditional = /([^{?])(.*?)(?=\\}\\})/g\r\nconst re = /{{([^{}]+)}}/g\r\nconst modelRaw = /\\{\\{model:([^{}]+)\\}\\}/g\r\n\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\nconst DOCUMENT_COMMENT_TYPE = 8\r\n\r\nfunction testEventNode (node) {\r\n  let nodeAttributes = node.attributes\r\n  let i = 0\r\n  let a\r\n  let name\r\n  let value\r\n  let evtName\r\n  let handler\r\n  let evtStore = []\r\n  let obs\r\n  let args\r\n\r\n  while (i < nodeAttributes.length) {\r\n    a = nodeAttributes[i]\r\n    name = a.localName\r\n    value = a.nodeValue\r\n    if (/^k-/.test(name)) {\r\n      evtName = name.replace(/^k-/, '')\r\n      handler = value.match(/[a-zA-Z]+(?![^(]*\\))/)[0]\r\n      args = value.match(/\\(([^{}]+)\\)/)\r\n      args = args ? args[1] : ''\r\n      obs = {}\r\n      obs[evtName] = handler\r\n      if (args) obs[args] = true\r\n      obs['isModel'] = false\r\n      evtStore.push(obs)\r\n      if (node.hasChildNodes() && node.firstChild.nodeType !== DOCUMENT_ELEMENT_TYPE && node.firstChild.nodeValue.match(modelRaw)) {\r\n        obs['isModel'] = true\r\n      }\r\n    }\r\n    i++\r\n  }\r\n  return evtStore\r\n}\r\n\r\nlet events\r\nlet c\r\nlet currentNode\r\n\r\nfunction recon (node, addState, model) {\r\n  while (node) {\r\n    currentNode = node\r\n    node = node.nextSibling\r\n    if (currentNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n      if (currentNode.hasAttributes()) {\r\n        inspectAttributes.call(this, currentNode, addState, model)\r\n\r\n        // to take advantage of caching always assigned id to the node\r\n        // we only assign eventListener on first mount to DOM or when the node is not available on DOM\r\n        if (!getId(currentNode.id)) {\r\n          events = testEventNode.call(this, currentNode)\r\n          if (events.length) {\r\n            events.map(e => {\r\n              !e.isModel ? addEvent.call(this, currentNode, e) : addEventModel.call(this, currentNode, e)\r\n              currentNode.removeAttribute(`k-${Object.keys(e)[0]}`)\r\n            })\r\n          }\r\n        }\r\n      }\r\n      recon.call(this, currentNode.firstChild, addState, model)\r\n    } else if (currentNode.nodeType === DOCUMENT_COMMENT_TYPE && currentNode.nodeValue.match(conditionalNodesRawStart)) {\r\n      c = currentNode.nodeValue.trim().match(reConditional)\r\n      c = c && c[0]\r\n      if (this[c]) {\r\n        conditionalNodes.call(this, currentNode, c, 'conditional-set', reconcile, addState)\r\n      }\r\n    } else if (currentNode.nodeType === DOCUMENT_COMMENT_TYPE && currentNode.nodeValue.match(re) && !currentNode.nodeValue.match(conditionalNodesRawStart)) {\r\n      replaceCommentBlock.call(this, currentNode.nodeValue, currentNode, reconcile)\r\n    } else {\r\n      replaceHandleBars.call(this, currentNode.nodeValue, currentNode, addState, null, model)\r\n    }\r\n  }\r\n}\r\n\r\nfunction reconcile (instance, addState, model) {\r\n  recon.call(this, instance, addState, model)\r\n}\r\n\r\nexport default reconcile\r\n","import { getId } from '../../../utils'\r\n\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\n\r\nfunction isEqual (oldNode, newNode) {\r\n  return (\r\n    (isPristine(newNode) ||\r\n    isIgnored(oldNode) && isIgnored(newNode)) ||\r\n    oldNode.isEqualNode(newNode)\r\n  )\r\n}\r\n\r\nfunction isIgnored (node) {\r\n  return node.getAttribute('data-ignore') != null\r\n}\r\n\r\nfunction arbiter (oldNode, newNode) {\r\n  if (oldNode.nodeName !== 'INPUT') return\r\n  if (oldNode.checked !== newNode.checked) {\r\n    oldNode.checked = newNode.checked\r\n  }\r\n}\r\n\r\nfunction setAttr (oldNode, newNode) {\r\n  let oAttr = newNode.attributes\r\n  let output = {}\r\n  let i = 0\r\n  while (i < oAttr.length) {\r\n    output[oAttr[i].name] = oAttr[i].value\r\n    i++\r\n  }\r\n  let iAttr = oldNode.attributes\r\n  let input = {}\r\n  let j = 0\r\n  while (j < iAttr.length) {\r\n    input[iAttr[j].name] = iAttr[j].value\r\n    j++\r\n  }\r\n  for (let attr in output) {\r\n    if (oldNode.attributes[attr] && oldNode.attributes[attr].name === attr && oldNode.attributes[attr].value !== output[attr]) {\r\n      oldNode.setAttribute(attr, output[attr])\r\n    } else {\r\n      // add new attributes as long is not part of k-<eventListener>\r\n      if (!oldNode.hasAttribute(attr) && !/^k-/.test(attr)) {\r\n        oldNode.setAttribute(attr, output[attr])\r\n      }\r\n    }\r\n  }\r\n  for (let attr in input) {\r\n    // if attributes does not exist on the new node we removed it from the old node\r\n    if (newNode.attributes[attr] && oldNode.attributes[attr]) {\r\n    } else {\r\n      oldNode.removeAttribute(attr)\r\n    }\r\n  }\r\n}\r\n\r\nfunction patch (oldNode, newNode) {\r\n  if (oldNode.nodeType === newNode.nodeType) {\r\n    if (oldNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n      arbiter(oldNode, newNode)\r\n      if (isEqual(oldNode, newNode)) return\r\n      diff(oldNode.firstChild, newNode.firstChild)\r\n      if (oldNode.nodeName === newNode.nodeName) {\r\n        setAttr(oldNode, newNode)\r\n      } else {\r\n        oldNode.parentNode.replaceChild(newNode, oldNode)\r\n      }\r\n    } else {\r\n      if (oldNode.nodeValue !== newNode.nodeValue) {\r\n        oldNode.nodeValue = newNode.nodeValue\r\n      }\r\n    }\r\n  } else {\r\n    oldNode.parentNode.replaceChild(newNode, oldNode)\r\n  }\r\n}\r\n\r\nfunction getIndex (store, count) {\r\n  return store.length - count - 1\r\n}\r\n\r\nlet checkNew\r\nlet checkOld\r\n\r\nfunction diff (oldNode, newNode, ignoreNextSibling) {\r\n  let count = 0\r\n  let newStore = []\r\n  while (newNode) {\r\n    count++\r\n    checkNew = newNode\r\n    newNode = ignoreNextSibling ? null : newNode.nextSibling\r\n    newStore.push(checkNew)\r\n  }\r\n  let index\r\n  let oldParentNode = oldNode && oldNode.parentNode\r\n  while (oldNode) {\r\n    count--\r\n    checkOld = oldNode\r\n    oldNode = ignoreNextSibling ? null : oldNode.nextSibling\r\n    index = getIndex(newStore, count)\r\n    if (checkOld && newStore[index]) {\r\n      patch(checkOld, newStore[index])\r\n    } else if (checkOld && !newStore[index]) {\r\n      oldParentNode.removeChild(checkOld)\r\n    }\r\n    if (oldNode === null) {\r\n      while (count > 0) {\r\n        count--\r\n        index = getIndex(newStore, count)\r\n        oldParentNode.appendChild(newStore[index])\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction isPristine (node) {\r\n  return node.hasAttribute('pristine-model')\r\n}\r\n\r\nfunction diffNodes (instance) {\r\n  let base = getId(this.el)\r\n  if (base && !this.IS_STUB) {\r\n    diff(base.firstChild, instance)\r\n  } else if (base && !isPristine(instance)) {\r\n    diff(base.firstChild, instance.firstChild)\r\n  }\r\n}\r\n\r\nfunction diffModelNodes (oldModel, newModel, ignoreNextSibling) {\r\n  diff(oldModel, newModel, ignoreNextSibling)\r\n}\r\n\r\nexport {\r\n  diffNodes as default,\r\n  diffModelNodes\r\n}\r\n","// import conditionalSet from './templateParse/conditionalSet'\r\nimport reconcile from './templateParse/reconcile'\r\n// import eventBuff from './templateParse/eventBuff'\r\nimport diffNodes from './templateParse/diffNodes'\r\nimport strInterpreter from './strInterpreter'\r\n\r\nconst DELAY = 0\r\n\r\nconst morpher = function () {\r\n  genElement.call(this)\r\n  // exec life-cycle componentDidUpdate\r\n  if (this.componentDidUpdate && typeof this.componentDidUpdate === 'function') {\r\n    this.componentDidUpdate()\r\n  }\r\n}\r\n\r\nlet timer = {}\r\n\r\nconst updateContext = function (fn, delay) {\r\n  timer[this.ID] = timer[this.ID] || null\r\n  clearTimeout(timer[this.ID])\r\n  timer[this.ID] = setTimeout(() => fn.call(this), delay)\r\n}\r\n\r\nconst nextState = function (i) {\r\n  let self = this\r\n  let state\r\n  let value\r\n  if (!stateList[this.ID]) return\r\n  if (i < stateList[this.ID].length) {\r\n    state = stateList[this.ID][i]\r\n    value = this[state]\r\n\r\n    // if value is undefined, likely has object notation we convert it to array\r\n    if (value === undefined) value = strInterpreter(state)\r\n\r\n    if (value && Array.isArray(value)) {\r\n      // using split object notation as base for state update\r\n      let inVal = this[value[0]][value[1]]\r\n\r\n      Object.defineProperty(this[value[0]], value[1], {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          return inVal\r\n        },\r\n        set: function (val) {\r\n          inVal = val\r\n          updateContext.call(self, morpher, DELAY)\r\n        }\r\n      })\r\n    } else {\r\n      // handle parent state update if the state is not an object\r\n      Object.defineProperty(this, state, {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          return value\r\n        },\r\n        set: function (val) {\r\n          value = val\r\n          updateContext.call(self, morpher, DELAY)\r\n        }\r\n      })\r\n    }\r\n    i++\r\n    nextState.call(this, i)\r\n  }\r\n}\r\n\r\nconst setState = function () {\r\n  nextState.call(this, 0)\r\n}\r\n\r\nlet stateList = {}\r\n\r\nfunction clearState () {\r\n  if (stateList[this.ID]) stateList[this.ID] = []\r\n}\r\n\r\nfunction addState (state) {\r\n  stateList[this.ID] = stateList[this.ID] || []\r\n  if (stateList[this.ID].indexOf(state) === -1) { stateList[this.ID] = stateList[this.ID].concat(state) }\r\n}\r\n\r\nconst genElement = function () {\r\n  this.base = this.__pristineFragment__.cloneNode(true)\r\n  // conditionalSet.call(this, this.base.firstChild)\r\n  reconcile.call(this, this.base.firstChild, addState.bind(this))\r\n  // eventBuff.call(this, this.base.firstChild)\r\n  diffNodes.call(this, this.base.firstChild)\r\n}\r\n\r\nexport {\r\n  genElement,\r\n  addState,\r\n  setState,\r\n  clearState,\r\n  updateContext,\r\n  morpher\r\n}\r\n","import conditionalCache from './templateParse/conditionalCache'\r\n// import conditionalSet from './templateParse/conditionalSet'\r\nimport reconcile from './templateParse/reconcile'\r\n// import eventBuff from './templateParse/eventBuff'\r\nimport { setState, addState } from './genElement'\r\nimport { getId, assert } from '../../utils'\r\n\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\n\r\nexport default function (stub) {\r\n  conditionalCache.call(this, addState.bind(this))\r\n  // conditionalSet.call(this, this.base.firstChild)\r\n  reconcile.call(this, this.base.firstChild, addState.bind(this))\r\n  // eventBuff.call(this, this.base.firstChild)\r\n  const el = stub || getId(this.el)\r\n  if (el) {\r\n    if (el.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n      el.setAttribute('data-ignore', '')\r\n    } else {\r\n      assert(this.base.childNodes.length === 1, 'Sub-component should only has a single rootNode.')\r\n      !this.base.firstChild.hasAttribute('data-ignore') && this.base.firstChild.setAttribute('data-ignore', '')\r\n    }\r\n    // listen to state changes\r\n    setState.call(this)\r\n    // mount fragment to DOM\r\n    if (!stub) {\r\n      el.appendChild(this.base)\r\n    }\r\n\r\n    // since component already rendered, trigger its life-cycle method\r\n    if (this.componentDidMount && typeof this.componentDidMount === 'function') {\r\n      this.componentDidMount()\r\n    }\r\n  } else {\r\n    assert(false, 'No element with id: \"' + this.el + '\" exist.')\r\n  }\r\n}\r\n","import { minId } from '../../utils'\r\n\r\n/**\r\n * @module keet/createModel\r\n * @example\r\n * import { createModel } from 'keet'\r\n *\r\n * class myModel extends createModel {\r\n *   contructor() {\r\n *     super()\r\n *     // props \r\n *   }\r\n *   // new extended method\r\n *   myMethod(...args){\r\n *     this.list = args \r\n *   }\r\n * }\r\n *\r\n * const MyModel = new myModel()\r\n */\r\n\r\n// check two objects properties attribute kdata-id and return the value equality\r\nconst notEqual = function (a, b) {\r\n  return a['kdata-id'] !== b['kdata-id']\r\n}\r\n\r\nlet async = {}\r\n\r\n// We otimize component lifeCycle triggering by trottling the model batch updates\r\nconst inform = function (...args) {\r\n  if (async[this.mId]) clearTimeout(async[this.mId])\r\n  async[this.mId] = setTimeout(() =>\r\n    this.exec && typeof this.exec === 'function' && this.exec.apply(null, args)\r\n    , 0)\r\n}\r\n\r\n/**\r\n * The model constructor, use with template literal having\r\n * ```{{model:<myModel>}}<myModelTemplateString>{{/model:<myModel>}}```\r\n * @alias module:keet/createModel\r\n * @param {*} enableFiltering - any truthy value \r\n *\r\n */\r\nexport default class createModel {\r\n  constructor (enableFiltering) {\r\n    this.mId = this.indentity\r\n\r\n    async[this.mId] = null\r\n    // if enableFiltering is assigned a value, model generation will\r\n    // use `listFilter` instead of `list`\r\n    this.enableFiltering = enableFiltering || null\r\n\r\n    this.model = []\r\n\r\n    // Register callback listener of any changes\r\n    Object.defineProperty(this, 'list', {\r\n      enumerable: false,\r\n      configurable: true,\r\n      get: function () {\r\n        return this.model\r\n      },\r\n      set: function (val) {\r\n        this.model = val\r\n        this.dirty = true\r\n        inform.call(this, this.model, this.listFilter)\r\n      }\r\n    })\r\n\r\n    // Register callback listener of any changes with filter\r\n    Object.defineProperty(this, 'listFilter', {\r\n      enumerable: false,\r\n      configurable: true,\r\n      get: function () {\r\n        return !this.prop ? this.model : this.model.filter(obj => obj[this.prop] === this.value)\r\n      }\r\n    })\r\n  }\r\n\r\n  // set identity for this model\r\n  static get indentity () {\r\n    return minId()\r\n  }\r\n\r\n  /**\r\n   * Subscribe to the model changes, the function callback first argument\r\n   * is the ```model.list``` and the second argument is ```model.listFilter```\r\n   * @param {Function} fn - the function callback for the subscribe\r\n   */\r\n  subscribe (fn) {\r\n    this.exec = fn\r\n  }\r\n\r\n  /**\r\n   * Add new object to the model list\r\n   * @param {Object} obj - new object to add into the model list\r\n   */\r\n  add (obj) {\r\n    this.list = this.list.concat({ ...obj, 'kdata-id': minId() })\r\n  }\r\n\r\n  /**\r\n   * Update existing object in the model list\r\n   * @param {Object} updateObj - the updated properties\r\n   */\r\n  update (updateObj) {\r\n    this.list = this.list.map(obj =>\r\n      notEqual(obj, updateObj) ? obj : updateObj\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Filter the model data by selected properties, constructor\r\n   * instantiation should be apply with boolean true as argument\r\n   * to enable filtering\r\n   * @param {standard} prop - property of the object\r\n   * @param {standard} value - property value\r\n   */\r\n  filter (prop, value) {\r\n    this.prop = prop\r\n    this.value = value\r\n    this.list = this.list\r\n  }\r\n\r\n  /**\r\n * Removed existing object in the model list\r\n * @param {Object} destroyObj - the object ref to remove from the model\r\n */\r\n  destroy (destroyObj) {\r\n    this.list = this.list.filter(obj => {\r\n      return notEqual(obj, destroyObj)\r\n    })\r\n  }\r\n}","import { clearState } from '../components/genElement'\r\nimport { assert } from '../../utils'\r\n\r\nconst DOCUMENT_FRAGMENT_TYPE = 11\r\nconst DOCUMENT_TEXT_TYPE = 3\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\n/**\r\n * @private\r\n * @description\r\n * Mount an instance of string or html elements\r\n *\r\n * @param {String|Object} instance - the html/string\r\n */\r\nexport default function (instance) {\r\n  let base\r\n  let tempDiv\r\n  let frag = document.createDocumentFragment()\r\n  // Before we begin to parse an instance, do a run-down checks\r\n  // to clean up back-tick string which usually has line spacing.\r\n  if (typeof instance === 'string') {\r\n    base = instance.trim().replace(/\\s+/g, ' ')\r\n    tempDiv = document.createElement('div')\r\n    tempDiv.innerHTML = base\r\n    while (tempDiv.firstChild) {\r\n      frag.appendChild(tempDiv.firstChild)\r\n    }\r\n  // If instance is a html element process as html entities\r\n  } else if (typeof instance === 'object' && instance['nodeType']) {\r\n    if (instance['nodeType'] === DOCUMENT_ELEMENT_TYPE) {\r\n      frag.appendChild(instance)\r\n    } else if (instance['nodeType'] === DOCUMENT_FRAGMENT_TYPE) {\r\n      frag = instance\r\n    } else if (instance['nodeType'] === DOCUMENT_TEXT_TYPE) {\r\n      frag.appendChild(instance)\r\n    } else {\r\n      assert(false, 'Unable to parse instance, unknown type.')\r\n    }\r\n  } else {\r\n    assert(false, 'Parameter is not a string or a html element.')\r\n  }\r\n  // we store the pristine instance in __pristineFragment__\r\n  this.__pristineFragment__ = frag.cloneNode(true)\r\n  this.base = frag\r\n\r\n  // cleanup states on mount\r\n  clearState.call(this)\r\n  return this\r\n}\r\n","\r\n/**\r\n * Keetjs v4.0.0 Alpha release: https://github.com/keetjs/keet\r\n * Minimalist view layer for the web\r\n *\r\n * <<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Keetjs >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n *\r\n * Copyright 2018, Shahrul Nizam Selamat\r\n * Released under the MIT License.\r\n */\r\n\r\nimport parseStr from './src/components/parseStr'\r\nimport { updateContext, morpher } from './src/components/genElement'\r\nimport { genId, assert, html } from './utils'\r\nimport createModel from './src/base/createModel'\r\nimport mount from './src/base/mount'\r\n\r\n// allow debugging using shorthand l and tr\r\nfunction debugMode() { \r\n  window.l = console.log.bind(console)\r\n  window.tr = console.trace.bind(console)\r\n}\r\n\r\ndebugMode()\r\n\r\n/**\r\n * @description\r\n * The main constructor of Keet\r\n */\r\nclass Keet {\r\n  constructor (name) {\r\n    this.ID = Keet.indentity\r\n    if(name){\r\n      this.storeRef(name)\r\n    }\r\n  }\r\n\r\n  // generate ID for the component\r\n  static get indentity () {\r\n    return genId()\r\n  }\r\n\r\n  mount (instance) {\r\n    return mount.call(this, instance)\r\n  }\r\n\r\n  link (id) {\r\n    // The target DOM where the rendering will took place.\r\n    if (!id) assert(id, 'No id is given as parameter.')\r\n    this.el = id\r\n    this.render()\r\n    return this\r\n  }\r\n\r\n  render (stub) {\r\n    // life-cycle method before rendering the component\r\n    if (this.componentWillMount && typeof this.componentWillMount === 'function') {\r\n      this.componentWillMount()\r\n    }\r\n\r\n    // Render this component to the target DOM\r\n    if (stub) {\r\n      this.IS_STUB = true\r\n    }\r\n    parseStr.call(this, stub)\r\n  }\r\n\r\n  callBatchPoolUpdate () {\r\n    // force component to update, if any state / non-state\r\n    // value changed DOM diffing will occur\r\n    updateContext.call(this, morpher, 1)\r\n  }\r\n  // pub-sub of the component, a component can subscribe to changes\r\n  // of another component, this is the subscribe method\r\n  subscribe (fn) {\r\n    this.exec = fn\r\n  }\r\n  // pub-sub of the component, a component can subscribe to changes\r\n  // of another component, this is the publish method\r\n  inform (model) {\r\n    this.exec && typeof this.exec === 'function' && this.exec(model)\r\n  }\r\n\r\n  // store in global ref\r\n  storeRef (name){\r\n    window.__keetGlobalComponentRef__ = window.__keetGlobalComponentRef__ || {}\r\n    if(window.__keetGlobalComponentRef__[name]) {\r\n      assert(false, `The component name: ${name} already exist in the global pool.`)\r\n    } else {\r\n      window.__keetGlobalComponentRef__[name] = this\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  Keet as default,\r\n  html,\r\n  createModel\r\n}\r\n"],"names":["state","updateStateList","conditionalNodesRawEnd","DOCUMENT_ELEMENT_TYPE","DOCUMENT_COMMENT_TYPE","cache","catchNode","node","start","cNode","nextSibling","nodeType","isEqualNode","remove","firstChild","resolveConditionalNodes","conditional","setup","runner","addState","currentNode","fetchFrag","frag","document","createDocumentFragment","hasOwnProperty","nodeValue","match","__pristineFragment__","appendChild","cloneNode","call","parentNode","insertBefore","conditionalNodesRawStart","reConditional","nodes","check","trim","concat","conditionalCache","base","i","length","updateState","bind","conditionalNodes","removeProtoModel","id","p","getElementById","childNodes","genModelList","model","reconcile","modelList","listClone","list","listArg","mLength","enableFiltering","undefined","dirty","setAttribute","lastChild","genId","rd","Math","random","toString","minId","getId","assert","val","msg","Error","html","args","literals","shift","substs","slice","result","raw","reduce","acc","lit","split","map","t","join","cacheInit","getKeetGlobalComponent","component","window","babelHelpers.typeof","__keetGlobalComponentRef__","componentStr","replace","c","ID","render","replaceChild","el","callBatchPoolUpdate","re","value","rep","modelRep","componentParse","test","str","input","condition","leftHand","rightHand","res","withTo","RegExp","isAttr","props","ln","tnr","isObjectNotation","self","ref","ternaryOps","strInterpreter","valAssign","inspectAttributes","nodeAttributes","attributes","a","ns","name","localName","removeAttribute","replaceHandleBars","lookupParentNode","rootNode","hasAttribute","getAttribute","getIndex","m","indexOf","addEvent","evtData","evtName","Object","keys","handler","addEventListener","fn","e","stopPropagation","target","currentTarget","addEventModel","modelRaw","testEventNode","evtStore","obs","push","hasChildNodes","events","recon","hasAttributes","isModel","replaceCommentBlock","instance","isEqual","oldNode","newNode","isPristine","isIgnored","arbiter","nodeName","checked","setAttr","oAttr","output","iAttr","j","attr","patch","diff","store","count","checkNew","checkOld","ignoreNextSibling","newStore","index","oldParentNode","removeChild","diffNodes","IS_STUB","DELAY","morpher","genElement","componentDidUpdate","timer","updateContext","delay","clearTimeout","setTimeout","nextState","stateList","Array","isArray","inVal","defineProperty","enumerable","configurable","get","set","setState","clearState","stub","componentDidMount","notEqual","b","async","inform","mId","exec","apply","createModel","indentity","listFilter","prop","filter","obj","subscribe","add","update","updateObj","destroy","destroyObj","DOCUMENT_FRAGMENT_TYPE","DOCUMENT_TEXT_TYPE","tempDiv","createElement","innerHTML","debugMode","l","console","log","tr","trace","Keet","storeRef","mount","link","componentWillMount","parseStr"],"mappings":";;;EAAe,sBAAUA,KAAV,EAAiBC,eAAjB,EAAkC;EAC/C,MAAI,OAAOA,eAAP,KAA2B,UAA/B,EAA2CA,gBAAgBD,KAAhB;EAC5C;;ECFD,IAAME,yBAAyB,qBAA/B;EACA,IAAMC,wBAAwB,CAA9B;EACA,IAAMC,wBAAwB,CAA9B;;EAEA,IAAIC,QAAQ,EAAZ;;EAEA;EACA,SAASC,SAAT,CAAoBC,IAApB,EAA0BC,KAA1B,EAAiC;EAC/B,MAAIC,cAAJ;EACA,SAAOF,IAAP,EAAa;EACXE,YAAQF,IAAR;EACAA,WAAOA,KAAKG,WAAZ;EACA,QAAID,SAASA,MAAME,QAAN,KAAmBR,qBAAhC,EAAuD;EACrD,UAAIM,MAAMG,WAAN,CAAkBJ,KAAlB,CAAJ,EAA8B;EAC5BC,cAAMI,MAAN;EACAL,gBAAQA,MAAME,WAAd;EACD,OAHD,MAGO;EACLJ,kBAAUG,MAAMK,UAAhB,EAA4BN,KAA5B;EACD;EACF,KAPD,MAOO,IAAIC,MAAMG,WAAN,CAAkBJ,KAAlB,CAAJ,EAA8B;EACnCC,YAAMI,MAAN;EACAL,cAAQA,MAAME,WAAd;EACD;EACF;EACF;;EAED,SAASK,uBAAT,CAAkCR,IAAlC,EAAwCS,WAAxC,EAAqDC,KAArD,EAA4DC,MAA5D,EAAoEC,QAApE,EAA8E;EAC5E,MAAIC,oBAAJ;EACA,MAAIX,cAAJ;EACA,MAAIY,kBAAJ;EACA,MAAIC,OAAOC,SAASC,sBAAT,EAAX;EACA,MAAIP,UAAU,SAAV,IAAuB,CAACZ,MAAMoB,cAAN,CAAqBT,WAArB,CAA5B,EAA+D;EAC7DP,YAAQF,IAAR;EACA,WAAOE,KAAP,EAAc;EACZW,oBAAcX,KAAd;EACAA,cAAQA,MAAMC,WAAd;EACA,UAAIU,YAAYT,QAAZ,KAAyBR,qBAAzB,IAAkDiB,YAAYM,SAAZ,CAAsBC,KAAtB,CAA4BzB,sBAA5B,CAAtD,EAA2G;EACzGO,gBAAQ,IAAR;EACAJ,cAAMW,WAAN,IAAqBX,MAAMW,WAAN,KAAsB,EAA3C;EACA;EACAV,kBAAU,KAAKsB,oBAAL,CAA0Bd,UAApC,EAAgDQ,KAAKR,UAArD;EACA;EACAT,cAAMW,WAAN,EAAmBM,IAAnB,GAA0BA,IAA1B;EACD,OAPD,MAOO,IAAIF,YAAYT,QAAZ,KAAyBP,qBAA7B,EAAoD;EACzDkB,aAAKO,WAAL,CAAiBT,WAAjB;EACD;EACF;EACF,GAhBD,MAgBO,IAAIH,UAAU,iBAAd,EAAiC;EACtC,QAAIV,KAAKG,WAAL,CAAiBE,WAAjB,CAA6BP,MAAMW,WAAN,EAAmBM,IAAnB,CAAwBR,UAArD,CAAJ,EAAsE;EACtEO,gBAAYhB,MAAMW,WAAN,EAAmBM,IAAnB,CAAwBQ,SAAxB,CAAkC,IAAlC,CAAZ;EACAZ,WAAOa,IAAP,CAAY,IAAZ,EAAkBV,UAAUP,UAA5B,EAAwCK,QAAxC;EACAZ,SAAKyB,UAAL,CAAgBC,YAAhB,CAA6BZ,SAA7B,EAAwCd,KAAKG,WAA7C;EACD;EACF;;EClDD,IAAMP,0BAAwB,CAA9B;EACA,IAAMC,0BAAwB,CAA9B;EACA,IAAM8B,2BAA2B,qBAAjC;EACA,IAAMC,gBAAgB,uBAAtB;;EAEA,IAAInB,oBAAJ;EACA,IAAII,oBAAJ;EACA,IAAIpB,cAAJ;EACA,IAAIoC,cAAJ;;EAEA,SAASC,KAAT,CAAgB9B,IAAhB,EAAsB;EACpB,SAAOA,IAAP,EAAa;EACXa,kBAAcb,IAAd;EACAA,WAAOA,KAAKG,WAAZ;EACA,QAAIU,YAAYT,QAAZ,KAAyBR,uBAA7B,EAAoD;EAClDkC,YAAMN,IAAN,CAAW,IAAX,EAAiBX,YAAYN,UAA7B;EACD,KAFD,MAEO,IAAIM,YAAYT,QAAZ,KAAyBP,uBAAzB,IAAkDgB,YAAYM,SAAZ,CAAsBC,KAAtB,CAA4BO,wBAA5B,CAAtD,EAA6G;EAClHlB,oBAAcI,YAAYM,SAAZ,CAAsBY,IAAtB,GAA6BX,KAA7B,CAAmCQ,aAAnC,CAAd;EACAnC,cAAQA,MAAMuC,MAAN,CAAavB,WAAb,CAAR;EACAoB,cAAQA,MAAMG,MAAN,CAAanB,WAAb,CAAR;EACD;EACF;EACF;;EAED,SAASoB,gBAAT,CAA2BrB,QAA3B,EAAqC;EACnCnB,UAAQ,EAAR;EACAoC,UAAQ,EAAR;EACAC,QAAMN,IAAN,CAAW,IAAX,EAAiB,KAAKU,IAAL,CAAU3B,UAA3B;EACA,MAAI4B,IAAI1C,MAAM2C,MAAd;EACA,SAAOD,IAAI,CAAX,EAAc;EACZA;EACAE,gBAAY5C,MAAM0C,CAAN,CAAZ,EAAsBvB,SAAS0B,IAAT,CAAc,IAAd,CAAtB;EACAC,4BAAiBf,IAAjB,CAAsB,IAAtB,EAA4BK,MAAMM,CAAN,CAA5B,EAAsC1C,MAAM0C,CAAN,CAAtC,EAAgD,SAAhD;EACD;EACF;;ECpCD;EACA,IAAIrC,UAAQ,EAAZ;;EAEA,SAAS0C,gBAAT,CAA2BxC,IAA3B,EAAiCyC,EAAjC,EAAqC;EACnC,MAAIC,IAAI1C,KAAK2C,cAAL,CAAoBF,EAApB,CAAR;EACA,MAAIC,CAAJ,EAAOA,EAAEE,UAAF,CAAa,CAAb,EAAgBtC,MAAhB;EACR;;EAED,SAASuC,YAAT,CAAuB7C,IAAvB,EAA6B8C,KAA7B,EAAoCC,SAApC,EAA+C;EAC7C,MAAIC,kBAAJ;EACA,MAAIb,UAAJ;EACA,MAAIc,kBAAJ;EACA,MAAIxB,mBAAJ;EACA,MAAIyB,aAAJ;EACA,MAAIC,gBAAJ;EACA,MAAIC,gBAAJ;;EAEAtD,UAAMgD,KAAN,IAAehD,QAAMgD,KAAN,KAAgB,EAA/B;;EAEA;EACAK,YAAU,KAAKL,KAAL,KAAe,KAAKA,KAAL,EAAYO,eAA3B,GAA6C,YAA7C,GAA4D,MAAtE;;EAEA,MAAI,CAACvD,QAAMgD,KAAN,EAAaK,OAAb,CAAL,EAA4B;EAC1BrD,YAAMgD,KAAN,EAAaK,OAAb,IAAwBnD,KAAKG,WAAL,CAAiBoB,SAAjB,CAA2B,IAA3B,CAAxB;EACAvB,SAAKG,WAAL,CAAiBG,MAAjB;EACA;EACAkC,qBAAiB,KAAKnB,oBAAtB,EAA4CrB,KAAKyB,UAAL,CAAgBgB,EAA5D;EACD;;EAEDS,SAAOpD,QAAMgD,KAAN,EAAaK,OAAb,CAAP;;EAEA,MAAI,KAAKL,KAAL,MAAgBQ,SAAhB,IAA6B,KAAKR,KAAL,EAAY5B,cAAZ,CAA2BiC,OAA3B,CAAjC,EAAsE;EACpE1B,iBAAazB,KAAKyB,UAAlB;;EAEAuB,gBAAY,KAAKF,KAAL,EAAYK,OAAZ,CAAZ;;EAEA,QAAI,CAAC,KAAKL,KAAL,EAAYS,KAAjB,EAAwB;EACtB9B,iBAAW+B,YAAX,CAAwB,gBAAxB,EAA0C,EAA1C;EACA;EACD;;EAEDrB,QAAI,CAAJ;;EAEAiB,cAAUJ,UAAUZ,MAApB;;EAEA,WAAOD,IAAIiB,OAAX,EAAoB;EAClBH,kBAAYC,KAAK3B,SAAL,CAAe,IAAf,CAAZ;EACAwB,gBAAUvB,IAAV,CAAe,IAAf,EAAqByB,SAArB,EAAgC,IAAhC,EAAsCD,UAAUb,CAAV,CAAtC;EACAc,gBAAUO,YAAV,CAAuB,UAAvB,EAAmCR,UAAUb,CAAV,EAAa,UAAb,CAAnC;EACAV,iBAAWC,YAAX,CAAwBuB,SAAxB,EAAmCxB,WAAWgC,SAA9C;EACAtB;EACD;EACD,SAAKW,KAAL,EAAYS,KAAZ,GAAoB,KAApB;EACD;EACF;;ECvDD,IAAMG,QAAQ,SAARA,KAAQ,GAAM;EAClB,MAAMC,KAAK,SAALA,EAAK;EAAA,WAAM,CAACC,KAAKC,MAAL,KAAgB,CAAhB,GAAoB,IAArB,EAA2BC,QAA3B,CAAoC,EAApC,CAAN;EAAA,GAAX;EACA,oBAAgBH,IAAhB,SAAwBA,IAAxB;EACD,CAHD;;EAKA,IAAMI,QAAQ,SAARA,KAAQ;EAAA,SAAM,CAACH,KAAKC,MAAL,KAAgB,CAAhB,GAAoB,IAArB,EAA2BC,QAA3B,CAAoC,EAApC,CAAN;EAAA,CAAd;;EAEA,IAAME,QAAQ,SAARA,KAAQ;EAAA,SAAMhD,SAAS2B,cAAT,CAAwBF,EAAxB,CAAN;EAAA,CAAd;;EAoCA;;;;;;;;;EASA,IAAMwB,SAAS,SAATA,MAAS,CAACC,GAAD,EAAMC,GAAN,EAAc;EAC3B,MAAI,CAACD,GAAL,EAAU,MAAM,IAAIE,KAAJ,CAAU,YAAYD,GAAtB,CAAN;EACX,CAFD;;EAIA;;;;;;;;;;;AAWA,MAAME,OAAO,SAAPA,IAAO,GAAa;EAAA,oCAATC,IAAS;EAATA,QAAS;EAAA;;EACxB,MAAMC,WAAWD,KAAKE,KAAL,EAAjB;EACA,MAAMC,SAASH,KAAKI,KAAL,EAAf;;EAEA,MAAIC,SAASJ,SAASK,GAAT,CAAaC,MAAb,CAAoB,UAACC,GAAD,EAAMC,GAAN,EAAW5C,CAAX;EAAA,WAAiB2C,MAAML,OAAOtC,IAAI,CAAX,CAAN,GAAsB4C,GAAvC;EAAA,GAApB,CAAb;EACA;EACAJ,WAASA,OAAOK,KAAP,CAAa,KAAb,CAAT;EACAL,WAASA,OAAOM,GAAP,CAAW;EAAA,WAAKC,EAAEnD,IAAF,EAAL;EAAA,GAAX,EAA0BoD,IAA1B,CAA+B,EAA/B,CAAT;EACA,SAAOR,MAAP;EACD,CATD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECjEA,IAAIS,YAAY,EAAhB;;EAEA,SAASC,sBAAT,CAAgCC,SAAhC,EAA2C;EACzC,MAAIC,UAAUC,QAAOD,OAAOE,0BAAd,MAA6C,QAA3D,EAAqE;EACnE,WAAOF,OAAOE,0BAAP,CAAkCH,SAAlC,CAAP;EACD;EACD;EACD;;AAED,EAAe,yBAAUI,YAAV,EAAwB1F,IAAxB,EAA8B;EAC3C,MAAMsF,YAAYI,aAAaC,OAAb,CAAqB,YAArB,EAAmC,EAAnC,CAAlB;EACA,MAAMC,IAAI,KAAKN,SAAL,KAAmBD,uBAAuBC,SAAvB,CAA7B;EACA,MAAIM,MAAMtC,SAAV,EAAqB;EACnB;EACA,QAAI,CAAC8B,UAAUQ,EAAEC,EAAZ,CAAL,EAAsB;EACpBD,QAAEE,MAAF,CAAS,IAAT;EACAV,gBAAUQ,EAAEC,EAAZ,IAAkBD,EAAE1D,IAAF,CAAOX,SAAP,CAAiB,IAAjB,CAAlB;EACAvB,WAAKyB,UAAL,CAAgBsE,YAAhB,CAA6BH,EAAE1D,IAA/B,EAAqClC,IAArC;EACD,KAJD,MAIO;EACL;EACA,UAAI,CAACgE,MAAM4B,EAAEI,EAAR,CAAL,EAAkB;EAChBJ,UAAE1D,IAAF,GAAS0D,EAAEvE,oBAAF,CAAuBE,SAAvB,CAAiC,IAAjC,CAAT;EACAqE,UAAEE,MAAF,CAAS,IAAT;EACA9F,aAAKyB,UAAL,CAAgBsE,YAAhB,CAA6BH,EAAE1D,IAA/B,EAAqClC,IAArC;EACD,OAJD,MAIO;EACLA,aAAKyB,UAAL,CAAgBsE,YAAhB,CAA6BX,UAAUQ,EAAEC,EAAZ,EAAgBtE,SAAhB,CAA0B,IAA1B,CAA7B,EAA8DvB,IAA9D;EACA;EACA4F,UAAEK,mBAAF;EACD;EACF;EACF,GAlBD,MAkBO;EACLhC,WAAO,KAAP,EAAc,eAAeqB,SAAf,GAA2B,kBAAzC;EACD;EACF;;EChCD,IAAMY,KAAK,eAAX;EACA,IAAMpD,QAAQ,UAAd;EACA,IAAMwC,YAAY,sBAAlB;;AAEA,EAAe,8BAAUa,KAAV,EAAiBnG,IAAjB,EAAuB+C,SAAvB,EAAkC;EAC/C,MAAIqD,YAAJ;EACA,MAAIC,iBAAJ;;EAEA,MAAIF,MAAM/E,KAAN,CAAY8E,EAAZ,CAAJ,EAAqB;EACnBE,UAAMD,MAAMR,OAAN,CAAcO,EAAd,EAAkB,IAAlB,EAAwBnE,IAAxB,EAAN;EACA,QAAIqE,IAAIhF,KAAJ,CAAU0B,KAAV,CAAJ,EAAsB;EACpBuD,iBAAWD,IAAIT,OAAJ,CAAY,QAAZ,EAAsB,EAAtB,CAAX;EACA9C,mBAAarB,IAAb,CAAkB,IAAlB,EAAwBxB,IAAxB,EAA8BqG,QAA9B,EAAwCtD,SAAxC;EACD,KAHD,MAGO,IAAIqD,IAAIhF,KAAJ,CAAUkE,SAAV,CAAJ,EAA0B;EAC/BgB,qBAAe9E,IAAf,CAAoB,IAApB,EAA0B4E,GAA1B,EAA+BpG,IAA/B;EACD;EACF;EACF;;ECpBD;;EAEA,IAAMuG,OAAO,SAAPA,IAAO;EAAA,SAAOC,QAAQ,MAAR,IAAkBA,QAAQ,IAA1B,IAAkCA,QAAQ,MAA1C,GAAmD,EAAnD,GAAwDA,GAA/D;EAAA,CAAb;;AAEA,EAAe,qBAAUC,KAAV,EAAiB;EAC9B,MAAIA,MAAMrF,KAAN,CAAY,0CAAZ,CAAJ,EAA6D;EAC3D,QAAI8D,IAAIuB,MAAMzB,KAAN,CAAY,GAAZ,CAAR;EACA,QAAI0B,YAAYxB,EAAE,CAAF,CAAhB;EACA,QAAIyB,WAAWzB,EAAE,CAAF,EAAKF,KAAL,CAAW,GAAX,EAAgB,CAAhB,CAAf;EACA,QAAI4B,YAAY1B,EAAE,CAAF,EAAKF,KAAL,CAAW,GAAX,EAAgB,CAAhB,CAAhB;;EAEA;;EAEA,QAAI,IAAJ,EAAU;EACR,UAAI,KAAK0B,SAAL,CAAJ,EAAqB;EACnB,eAAO;EACLP,iBAAOI,KAAKI,QAAL,CADF;EAELlH,iBAAOiH;EAFF,SAAP;EAID,OALD,MAKO;EACL,eAAO;EACLP,iBAAOI,KAAKK,SAAL,CADF;EAELnH,iBAAOiH;EAFF,SAAP;EAID;EACF;EACD,WAAO,KAAP;EACD,GAtBD,MAsBO,OAAO,KAAP;EACR;;AC5BD,wBAAe,UAACF,GAAD,EAAS;EACtB,MAAIK,MAAML,IAAIpF,KAAJ,CAAU,QAAV,CAAV;EACA,MAAIuD,eAAJ;EACA,MAAIkC,OAAOA,IAAIzE,MAAJ,GAAa,CAAxB,EAA2B;EACzB,WAAOoE,IAAIxB,KAAJ,CAAU,GAAV,CAAP;EACD;EACD,SAAOL,MAAP;EACD,CAPD;;ECAe,oBAAU3E,IAAV,EAAgBmG,KAAhB,EAAuBR,OAAvB,EAAgCmB,MAAhC,EAAwC;EACrD,MAAIZ,KAAK,IAAIa,MAAJ,CAAWpB,OAAX,EAAoB,GAApB,CAAT;EACA3F,OAAKmB,SAAL,GAAiBnB,KAAKmB,SAAL,CAAewE,OAAf,CAAuBO,EAAvB,EAA2BY,MAA3B,CAAjB;EACD;;ECED,IAAMZ,OAAK,eAAX;;AAEA,EAAe,4BAAUC,KAAV,EAAiBnG,IAAjB,EAAuBY,QAAvB,EAAiCoG,MAAjC,EAAyClE,KAAzC,EAAgD;EAC7D,MAAMmE,QAAQd,MAAM/E,KAAN,CAAY8E,IAAZ,CAAd;EACA,MAAI,CAACe,KAAL,EAAY;EACZ,MAAIC,KAAKD,MAAM7E,MAAf;EACA,MAAIgE,YAAJ;EACA,MAAIe,YAAJ;EACA,MAAIC,yBAAJ;;EAEA,MAAIC,OAAO,IAAX;;EAEA,MAAIC,MAAMxE,SAAS,IAAnB;;EAEA,SAAOoE,EAAP,EAAW;EACTA;EACAd,UAAMa,MAAMC,EAAN,EAAUvB,OAAV,CAAkBO,IAAlB,EAAsB,IAAtB,CAAN;EACAiB,UAAMI,WAAW/F,IAAX,CAAgB8F,GAAhB,EAAqBlB,GAArB,CAAN;EACAgB,uBAAmBI,eAAepB,GAAf,CAAnB;EACA,QAAIgB,gBAAJ,EAAsB;EACpB,UAAI,CAACJ,MAAL,EAAa;EACX,YAAII,iBAAiB,CAAjB,MAAwB,MAAxB,IAAkCC,KAAKD,iBAAiB,CAAjB,CAAL,MAA8B9D,SAAhE,IAA6E,OAAO+D,KAAKD,iBAAiB,CAAjB,CAAL,CAAP,KAAqC,UAAtH,EAAkI;EAChI,cAAIzC,SAAS0C,KAAKD,iBAAiB,CAAjB,CAAL,GAAb;EACA,cAAIzC,WAAWrB,SAAf,EAA0B;EACxBmE,sBAAUzH,IAAV,EAAgBmG,KAAhB,EAAuB,OAAOC,GAAP,GAAa,IAApC,EAA0CzB,MAA1C;EACD;EACF,SALD,MAKO;EACLtC,sBAAY+D,GAAZ,EAAiBxF,QAAjB;EACA6G,oBAAUzH,IAAV,EAAgBmG,KAAhB,EAAuB,OAAOC,GAAP,GAAa,IAApC,EAA0CiB,KAAKD,iBAAiB,CAAjB,CAAL,EAA0BA,iBAAiB,CAAjB,CAA1B,CAA1C;EACD;EACF,OAVD,MAUO;EACL,YAAIA,iBAAiB,CAAjB,MAAwB,MAAxB,IAAkCC,KAAKD,iBAAiB,CAAjB,CAAL,MAA8B9D,SAAhE,IAA6E,OAAO+D,KAAKD,iBAAiB,CAAjB,CAAL,CAAP,KAAqC,UAAtH,EAAkI;EAChI,cAAIzC,UAAS0C,KAAKD,iBAAiB,CAAjB,CAAL,EAA0BE,GAA1B,CAAb;EACA,iBAAO3C,YAAWrB,SAAX,GAAuBqB,OAAvB,GAAgCwB,KAAvC;EACD,SAHD,MAGO;EACL9D,sBAAY+D,GAAZ,EAAiBxF,QAAjB;EACA,iBAAOuF,MAAMR,OAAN,CAAcsB,KAAd,EAAqBI,KAAKD,iBAAiB,CAAjB,CAAL,EAA0BA,iBAAiB,CAAjB,CAA1B,CAArB,CAAP;EACD;EACF;EACF,KApBD,MAoBO;EACL,UAAID,GAAJ,EAAS;EACP9E,oBAAY8E,IAAI1H,KAAhB,EAAuBmB,QAAvB;EACA,YAAI,CAACoG,MAAL,EAAa;EACXS,oBAAUzH,IAAV,EAAgBmG,KAAhB,EAAuB,OAAOC,GAAP,GAAa,IAApC,EAA0Ce,IAAIhB,KAA9C;EACD,SAFD,MAEO;EACL,iBAAOA,MAAMR,OAAN,CAAcsB,KAAd,EAAqBE,IAAIhB,KAAzB,CAAP;EACD;EACF,OAPD,MAOO;EACL,YAAImB,IAAIlB,GAAJ,MAAa9C,SAAjB,EAA4B;EAC1BjB,sBAAY+D,GAAZ,EAAiBxF,QAAjB;EACA,cAAI,CAACoG,MAAL,EAAa;EACXS,sBAAUzH,IAAV,EAAgBmG,KAAhB,EAAuB,OAAOC,GAAP,GAAa,IAApC,EAA0CkB,IAAIlB,GAAJ,CAA1C;EACD,WAFD,MAEO;EACL,mBAAOD,MAAMR,OAAN,CAAcsB,KAAd,EAAqBK,IAAIlB,GAAJ,CAArB,CAAP;EACD;EACF;EACF;EACF;EACF;EACF;;EC9DD,IAAMF,OAAK,eAAX;;EAEA,SAASwB,iBAAT,CAA4B1H,IAA5B,EAAkCY,QAAlC,EAA4CkC,KAA5C,EAAmD;EACjD,MAAI6E,iBAAiB3H,KAAK4H,UAA1B;EACA,MAAIzF,IAAI,CAAR;EACA,MAAI0F,UAAJ;EACA,MAAIC,WAAJ;EACA,MAAIC,aAAJ;;EAEA,OAAK5F,IAAIwF,eAAevF,MAAxB,EAAgCD,GAAhC,GAAsC;EACpC0F,QAAIF,eAAexF,CAAf,CAAJ;EACA4F,WAAOF,EAAEG,SAAT;EACAF,SAAKD,EAAE1G,SAAP;EACA,QAAI+E,KAAGK,IAAH,CAAQwB,IAAR,CAAJ,EAAmB;EACjB/H,WAAKiI,eAAL,CAAqBF,IAArB;EACAA,aAAOG,kBAAkB1G,IAAlB,CAAuB,IAAvB,EAA6BuG,IAA7B,EAAmC/H,IAAnC,EAAyCY,QAAzC,EAAmD,IAAnD,EAAyDkC,KAAzD,CAAP;EACA9C,WAAKwD,YAAL,CAAkBuE,IAAlB,EAAwBD,EAAxB;EACD,KAJD,MAIO,IAAI5B,KAAGK,IAAH,CAAQuB,EAAR,CAAJ,EAAiB;EACtBA,WAAKI,kBAAkB1G,IAAlB,CAAuB,IAAvB,EAA6BsG,EAA7B,EAAiC9H,IAAjC,EAAuCY,QAAvC,EAAiD,IAAjD,EAAuDkC,KAAvD,CAAL;EACA,UAAIiF,SAAS,SAAb,EAAwB;EACtB,YAAID,OAAO,EAAX,EAAe;EACb9H,eAAKiI,eAAL,CAAqBF,IAArB;EACA;EACD,SAHD,MAGO;EACL;EACA/H,eAAKwD,YAAL,CAAkBuE,IAAlB,EAAwB,EAAxB;EACD;EACD;EACD,OATD,MASO;EACL,YAAID,OAAO,EAAX,EAAe;EACb9H,eAAKwD,YAAL,CAAkBuE,IAAlB,EAAwB,EAAxB;EACD,SAFD,MAEO;EACL/H,eAAKwD,YAAL,CAAkBuE,IAAlB,EAAwBD,EAAxB;EACD;EACF;EACF;EACF;EACF;;ECvCD,IAAMlI,0BAAwB,CAA9B;EACA,IAAMsG,OAAK,eAAX;;EAEA,SAASiC,gBAAT,CAA2BC,QAA3B,EAAqCpI,IAArC,EAA2C;EACzC,MAAIE,cAAJ;EACA,SAAOF,IAAP,EAAa;EACXE,YAAQF,IAAR;EACAA,WAAOA,KAAKyB,UAAZ;EACA,QAAIvB,MAAME,QAAN,KAAmBR,uBAAnB,IAA4CM,MAAMmI,YAAN,CAAmB,UAAnB,CAAhD,EAAgF;EAC9E,aAAO,EAAE5F,IAAIvC,MAAMoI,YAAN,CAAmB,UAAnB,CAAN,EAAsCtI,MAAME,KAA5C,EAAP;EACD;EACD,QAAIA,MAAMG,WAAN,CAAkB+H,QAAlB,CAAJ,EAAiC;EAC/BpI,aAAO,IAAP;EACD;EACF;EACF;;EAED,IAAMuI,WAAW,SAAXA,QAAW,CAAC9F,EAAD,EAAKK,KAAL;EAAA,SAAeA,MAAMI,IAAN,CAAW+B,GAAX,CAAe;EAAA,WAAKuD,EAAE,UAAF,CAAL;EAAA,GAAf,EAAmCC,OAAnC,CAA2ChG,EAA3C,CAAf;EAAA,CAAjB;;EAEA,SAASiG,QAAT,CAAmB1I,IAAnB,EAAyB2I,OAAzB,EAAkC;EAChC;EACA,MAAIC,UAAUC,OAAOC,IAAP,CAAYH,OAAZ,EAAqB,CAArB,CAAd;EACA,MAAII,UAAUJ,QAAQC,OAAR,CAAd;EACA,MAAI,KAAKG,OAAL,MAAkBzF,SAAlB,IAA+B,OAAO,KAAKyF,OAAL,CAAP,KAAyB,UAA5D,EAAwE;EACtE/I,SAAKgJ,gBAAL,CAAsBJ,OAAtB,EAA+B,KAAKG,OAAL,EAAczG,IAAd,CAAmB,IAAnB,CAA/B,EAAyD,CAAC,CAACqG,QAAQ,YAAR,CAA3D;EACD;EACF;;EAED,SAASM,EAAT,CAAanG,KAAb,EAAoBiG,OAApB,EAA6B/I,IAA7B,EAAmCkJ,CAAnC,EAAsC;EACpCA,IAAEC,eAAF;EACA,MAAID,EAAEE,MAAF,KAAaF,EAAEG,aAAnB,EAAkC;EAChC,QAAInE,IAAIiD,iBAAiBnI,IAAjB,EAAuBkJ,EAAEE,MAAzB,CAAR;EACA,SAAKL,OAAL,EAAcjG,MAAMI,IAAN,CAAWqF,SAASrD,EAAEzC,EAAX,EAAeK,KAAf,CAAX,CAAd,EAAiDoG,EAAEE,MAAnD,EAA2DlE,EAAElF,IAA7D,EAAmEkJ,CAAnE;EACD;EACF;;EAED,SAASI,aAAT,CAAwBtJ,IAAxB,EAA8B2I,OAA9B,EAAuC;EACrC;EACA,MAAIC,UAAUC,OAAOC,IAAP,CAAYH,OAAZ,EAAqB,CAArB,CAAd;EACA,MAAII,UAAUJ,QAAQC,OAAR,CAAd;EACA,MAAI,KAAKG,OAAL,MAAkBzF,SAAlB,IAA+B,OAAO,KAAKyF,OAAL,CAAP,KAAyB,UAA5D,EAAwE;EACtE,QAAI3C,MAAMpG,KAAKO,UAAL,CAAgBY,SAAhB,CAA0BwE,OAA1B,CAAkCO,IAAlC,EAAsC,IAAtC,EAA4CnE,IAA5C,EAAV;EACAqE,UAAMA,IAAIT,OAAJ,CAAY,QAAZ,EAAsB,EAAtB,CAAN;EACA,QAAI7C,QAAQ,KAAKsD,GAAL,CAAZ;EACApG,SAAKgJ,gBAAL,CAAsBJ,OAAtB,EAA+BK,GAAG3G,IAAH,CAAQ,IAAR,EAAcQ,KAAd,EAAqBiG,OAArB,EAA8B/I,IAA9B,CAA/B,EAAoE,CAAC,CAAC2I,QAAQ,YAAR,CAAtE;EACD;EACF;;ECtCD,IAAMhH,6BAA2B,qBAAjC;EACA,IAAMC,kBAAgB,uBAAtB;EACA,IAAMsE,OAAK,eAAX;EACA,IAAMqD,WAAW,yBAAjB;;EAEA,IAAM3J,0BAAwB,CAA9B;EACA,IAAMC,0BAAwB,CAA9B;;EAEA,SAAS2J,aAAT,CAAwBxJ,IAAxB,EAA8B;EAC5B,MAAI2H,iBAAiB3H,KAAK4H,UAA1B;EACA,MAAIzF,IAAI,CAAR;EACA,MAAI0F,UAAJ;EACA,MAAIE,aAAJ;EACA,MAAI5B,cAAJ;EACA,MAAIyC,gBAAJ;EACA,MAAIG,gBAAJ;EACA,MAAIU,WAAW,EAAf;EACA,MAAIC,YAAJ;EACA,MAAIpF,aAAJ;;EAEA,SAAOnC,IAAIwF,eAAevF,MAA1B,EAAkC;EAChCyF,QAAIF,eAAexF,CAAf,CAAJ;EACA4F,WAAOF,EAAEG,SAAT;EACA7B,YAAQ0B,EAAE1G,SAAV;EACA,QAAI,MAAMoF,IAAN,CAAWwB,IAAX,CAAJ,EAAsB;EACpBa,gBAAUb,KAAKpC,OAAL,CAAa,KAAb,EAAoB,EAApB,CAAV;EACAoD,gBAAU5C,MAAM/E,KAAN,CAAY,sBAAZ,EAAoC,CAApC,CAAV;EACAkD,aAAO6B,MAAM/E,KAAN,CAAY,cAAZ,CAAP;EACAkD,aAAOA,OAAOA,KAAK,CAAL,CAAP,GAAiB,EAAxB;EACAoF,YAAM,EAAN;EACAA,UAAId,OAAJ,IAAeG,OAAf;EACA,UAAIzE,IAAJ,EAAUoF,IAAIpF,IAAJ,IAAY,IAAZ;EACVoF,UAAI,SAAJ,IAAiB,KAAjB;EACAD,eAASE,IAAT,CAAcD,GAAd;EACA,UAAI1J,KAAK4J,aAAL,MAAwB5J,KAAKO,UAAL,CAAgBH,QAAhB,KAA6BR,uBAArD,IAA8EI,KAAKO,UAAL,CAAgBY,SAAhB,CAA0BC,KAA1B,CAAgCmI,QAAhC,CAAlF,EAA6H;EAC3HG,YAAI,SAAJ,IAAiB,IAAjB;EACD;EACF;EACDvH;EACD;EACD,SAAOsH,QAAP;EACD;;EAED,IAAII,eAAJ;EACA,IAAIjE,UAAJ;EACA,IAAI/E,sBAAJ;;EAEA,SAASiJ,KAAT,CAAgB9J,IAAhB,EAAsBY,QAAtB,EAAgCkC,KAAhC,EAAuC;EAAA;;EACrC,SAAO9C,IAAP,EAAa;EACXa,oBAAcb,IAAd;EACAA,WAAOA,KAAKG,WAAZ;EACA,QAAIU,cAAYT,QAAZ,KAAyBR,uBAA7B,EAAoD;EAClD,UAAIiB,cAAYkJ,aAAZ,EAAJ,EAAiC;EAC/BrC,0BAAkBlG,IAAlB,CAAuB,IAAvB,EAA6BX,aAA7B,EAA0CD,QAA1C,EAAoDkC,KAApD;;EAEA;EACA;EACA,YAAI,CAACkB,MAAMnD,cAAY4B,EAAlB,CAAL,EAA4B;EAC1BoH,mBAASL,cAAchI,IAAd,CAAmB,IAAnB,EAAyBX,aAAzB,CAAT;EACA,cAAIgJ,OAAOzH,MAAX,EAAmB;EACjByH,mBAAO5E,GAAP,CAAW,aAAK;EACd,eAACiE,EAAEc,OAAH,GAAatB,SAASlH,IAAT,CAAc,KAAd,EAAoBX,aAApB,EAAiCqI,CAAjC,CAAb,GAAmDI,cAAc9H,IAAd,CAAmB,KAAnB,EAAyBX,aAAzB,EAAsCqI,CAAtC,CAAnD;EACArI,4BAAYoH,eAAZ,QAAiCY,OAAOC,IAAP,CAAYI,CAAZ,EAAe,CAAf,CAAjC;EACD,aAHD;EAID;EACF;EACF;EACDY,YAAMtI,IAAN,CAAW,IAAX,EAAiBX,cAAYN,UAA7B,EAAyCK,QAAzC,EAAmDkC,KAAnD;EACD,KAjBD,MAiBO,IAAIjC,cAAYT,QAAZ,KAAyBP,uBAAzB,IAAkDgB,cAAYM,SAAZ,CAAsBC,KAAtB,CAA4BO,0BAA5B,CAAtD,EAA6G;EAClHiE,UAAI/E,cAAYM,SAAZ,CAAsBY,IAAtB,GAA6BX,KAA7B,CAAmCQ,eAAnC,CAAJ;EACAgE,UAAIA,KAAKA,EAAE,CAAF,CAAT;EACA,UAAI,KAAKA,CAAL,CAAJ,EAAa;EACXrD,gCAAiBf,IAAjB,CAAsB,IAAtB,EAA4BX,aAA5B,EAAyC+E,CAAzC,EAA4C,iBAA5C,EAA+D7C,SAA/D,EAA0EnC,QAA1E;EACD;EACF,KANM,MAMA,IAAIC,cAAYT,QAAZ,KAAyBP,uBAAzB,IAAkDgB,cAAYM,SAAZ,CAAsBC,KAAtB,CAA4B8E,IAA5B,CAAlD,IAAqF,CAACrF,cAAYM,SAAZ,CAAsBC,KAAtB,CAA4BO,0BAA5B,CAA1F,EAAiJ;EACtJsI,0BAAoBzI,IAApB,CAAyB,IAAzB,EAA+BX,cAAYM,SAA3C,EAAsDN,aAAtD,EAAmEkC,SAAnE;EACD,KAFM,MAEA;EACLmF,wBAAkB1G,IAAlB,CAAuB,IAAvB,EAA6BX,cAAYM,SAAzC,EAAoDN,aAApD,EAAiED,QAAjE,EAA2E,IAA3E,EAAiFkC,KAAjF;EACD;EACF;EACF;;EAED,SAASC,SAAT,CAAoBmH,QAApB,EAA8BtJ,QAA9B,EAAwCkC,KAAxC,EAA+C;EAC7CgH,QAAMtI,IAAN,CAAW,IAAX,EAAiB0I,QAAjB,EAA2BtJ,QAA3B,EAAqCkC,KAArC;EACD;;EC1FD,IAAMlD,0BAAwB,CAA9B;;EAEA,SAASuK,OAAT,CAAkBC,OAAlB,EAA2BC,OAA3B,EAAoC;EAClC,SACGC,WAAWD,OAAX,KACDE,UAAUH,OAAV,KAAsBG,UAAUF,OAAV,CADtB,IAEAD,QAAQ/J,WAAR,CAAoBgK,OAApB,CAHF;EAKD;;EAED,SAASE,SAAT,CAAoBvK,IAApB,EAA0B;EACxB,SAAOA,KAAKsI,YAAL,CAAkB,aAAlB,KAAoC,IAA3C;EACD;;EAED,SAASkC,OAAT,CAAkBJ,OAAlB,EAA2BC,OAA3B,EAAoC;EAClC,MAAID,QAAQK,QAAR,KAAqB,OAAzB,EAAkC;EAClC,MAAIL,QAAQM,OAAR,KAAoBL,QAAQK,OAAhC,EAAyC;EACvCN,YAAQM,OAAR,GAAkBL,QAAQK,OAA1B;EACD;EACF;;EAED,SAASC,OAAT,CAAkBP,OAAlB,EAA2BC,OAA3B,EAAoC;EAClC,MAAIO,QAAQP,QAAQzC,UAApB;EACA,MAAIiD,SAAS,EAAb;EACA,MAAI1I,IAAI,CAAR;EACA,SAAOA,IAAIyI,MAAMxI,MAAjB,EAAyB;EACvByI,WAAOD,MAAMzI,CAAN,EAAS4F,IAAhB,IAAwB6C,MAAMzI,CAAN,EAASgE,KAAjC;EACAhE;EACD;EACD,MAAI2I,QAAQV,QAAQxC,UAApB;EACA,MAAInB,QAAQ,EAAZ;EACA,MAAIsE,IAAI,CAAR;EACA,SAAOA,IAAID,MAAM1I,MAAjB,EAAyB;EACvBqE,UAAMqE,MAAMC,CAAN,EAAShD,IAAf,IAAuB+C,MAAMC,CAAN,EAAS5E,KAAhC;EACA4E;EACD;EACD,OAAK,IAAIC,IAAT,IAAiBH,MAAjB,EAAyB;EACvB,QAAIT,QAAQxC,UAAR,CAAmBoD,IAAnB,KAA4BZ,QAAQxC,UAAR,CAAmBoD,IAAnB,EAAyBjD,IAAzB,KAAkCiD,IAA9D,IAAsEZ,QAAQxC,UAAR,CAAmBoD,IAAnB,EAAyB7E,KAAzB,KAAmC0E,OAAOG,IAAP,CAA7G,EAA2H;EACzHZ,cAAQ5G,YAAR,CAAqBwH,IAArB,EAA2BH,OAAOG,IAAP,CAA3B;EACD,KAFD,MAEO;EACL;EACA,UAAI,CAACZ,QAAQ/B,YAAR,CAAqB2C,IAArB,CAAD,IAA+B,CAAC,MAAMzE,IAAN,CAAWyE,IAAX,CAApC,EAAsD;EACpDZ,gBAAQ5G,YAAR,CAAqBwH,IAArB,EAA2BH,OAAOG,IAAP,CAA3B;EACD;EACF;EACF;EACD,OAAK,IAAIA,KAAT,IAAiBvE,KAAjB,EAAwB;EACtB;EACA,QAAI4D,QAAQzC,UAAR,CAAmBoD,KAAnB,KAA4BZ,QAAQxC,UAAR,CAAmBoD,KAAnB,CAAhC,EAA0D,CAA1D,MACO;EACLZ,cAAQnC,eAAR,CAAwB+C,KAAxB;EACD;EACF;EACF;;EAED,SAASC,KAAT,CAAgBb,OAAhB,EAAyBC,OAAzB,EAAkC;EAChC,MAAID,QAAQhK,QAAR,KAAqBiK,QAAQjK,QAAjC,EAA2C;EACzC,QAAIgK,QAAQhK,QAAR,KAAqBR,uBAAzB,EAAgD;EAC9C4K,cAAQJ,OAAR,EAAiBC,OAAjB;EACA,UAAIF,QAAQC,OAAR,EAAiBC,OAAjB,CAAJ,EAA+B;EAC/Ba,WAAKd,QAAQ7J,UAAb,EAAyB8J,QAAQ9J,UAAjC;EACA,UAAI6J,QAAQK,QAAR,KAAqBJ,QAAQI,QAAjC,EAA2C;EACzCE,gBAAQP,OAAR,EAAiBC,OAAjB;EACD,OAFD,MAEO;EACLD,gBAAQ3I,UAAR,CAAmBsE,YAAnB,CAAgCsE,OAAhC,EAAyCD,OAAzC;EACD;EACF,KATD,MASO;EACL,UAAIA,QAAQjJ,SAAR,KAAsBkJ,QAAQlJ,SAAlC,EAA6C;EAC3CiJ,gBAAQjJ,SAAR,GAAoBkJ,QAAQlJ,SAA5B;EACD;EACF;EACF,GAfD,MAeO;EACLiJ,YAAQ3I,UAAR,CAAmBsE,YAAnB,CAAgCsE,OAAhC,EAAyCD,OAAzC;EACD;EACF;;EAED,SAAS7B,UAAT,CAAmB4C,KAAnB,EAA0BC,KAA1B,EAAiC;EAC/B,SAAOD,MAAM/I,MAAN,GAAegJ,KAAf,GAAuB,CAA9B;EACD;;EAED,IAAIC,iBAAJ;EACA,IAAIC,iBAAJ;;EAEA,SAASJ,IAAT,CAAed,OAAf,EAAwBC,OAAxB,EAAiCkB,iBAAjC,EAAoD;EAClD,MAAIH,QAAQ,CAAZ;EACA,MAAII,WAAW,EAAf;EACA,SAAOnB,OAAP,EAAgB;EACde;EACAC,eAAWhB,OAAX;EACAA,cAAUkB,oBAAoB,IAApB,GAA2BlB,QAAQlK,WAA7C;EACAqL,aAAS7B,IAAT,CAAc0B,QAAd;EACD;EACD,MAAII,cAAJ;EACA,MAAIC,gBAAgBtB,WAAWA,QAAQ3I,UAAvC;EACA,SAAO2I,OAAP,EAAgB;EACdgB;EACAE,eAAWlB,OAAX;EACAA,cAAUmB,oBAAoB,IAApB,GAA2BnB,QAAQjK,WAA7C;EACAsL,YAAQlD,WAASiD,QAAT,EAAmBJ,KAAnB,CAAR;EACA,QAAIE,YAAYE,SAASC,KAAT,CAAhB,EAAiC;EAC/BR,YAAMK,QAAN,EAAgBE,SAASC,KAAT,CAAhB;EACD,KAFD,MAEO,IAAIH,YAAY,CAACE,SAASC,KAAT,CAAjB,EAAkC;EACvCC,oBAAcC,WAAd,CAA0BL,QAA1B;EACD;EACD,QAAIlB,YAAY,IAAhB,EAAsB;EACpB,aAAOgB,QAAQ,CAAf,EAAkB;EAChBA;EACAK,gBAAQlD,WAASiD,QAAT,EAAmBJ,KAAnB,CAAR;EACAM,sBAAcpK,WAAd,CAA0BkK,SAASC,KAAT,CAA1B;EACD;EACF;EACF;EACF;;EAED,SAASnB,UAAT,CAAqBtK,IAArB,EAA2B;EACzB,SAAOA,KAAKqI,YAAL,CAAkB,gBAAlB,CAAP;EACD;;EAED,SAASuD,SAAT,CAAoB1B,QAApB,EAA8B;EAC5B,MAAIhI,OAAO8B,MAAM,KAAKgC,EAAX,CAAX;EACA,MAAI9D,QAAQ,CAAC,KAAK2J,OAAlB,EAA2B;EACzBX,SAAKhJ,KAAK3B,UAAV,EAAsB2J,QAAtB;EACD,GAFD,MAEO,IAAIhI,QAAQ,CAACoI,WAAWJ,QAAX,CAAb,EAAmC;EACxCgB,SAAKhJ,KAAK3B,UAAV,EAAsB2J,SAAS3J,UAA/B;EACD;EACF;;EC/HD;AACA;EAKA,IAAMuL,QAAQ,CAAd;;EAEA,IAAMC,UAAU,SAAVA,OAAU,GAAY;EAC1BC,aAAWxK,IAAX,CAAgB,IAAhB;EACA;EACA,MAAI,KAAKyK,kBAAL,IAA2B,OAAO,KAAKA,kBAAZ,KAAmC,UAAlE,EAA8E;EAC5E,SAAKA,kBAAL;EACD;EACF,CAND;;EAQA,IAAIC,QAAQ,EAAZ;;EAEA,IAAMC,gBAAgB,SAAhBA,aAAgB,CAAUlD,EAAV,EAAcmD,KAAd,EAAqB;EAAA;;EACzCF,QAAM,KAAKrG,EAAX,IAAiBqG,MAAM,KAAKrG,EAAX,KAAkB,IAAnC;EACAwG,eAAaH,MAAM,KAAKrG,EAAX,CAAb;EACAqG,QAAM,KAAKrG,EAAX,IAAiByG,WAAW;EAAA,WAAMrD,GAAGzH,IAAH,CAAQ,KAAR,CAAN;EAAA,GAAX,EAAgC4K,KAAhC,CAAjB;EACD,CAJD;;EAMA,IAAMG,YAAY,SAAZA,SAAY,CAAUpK,CAAV,EAAa;EAC7B,MAAIkF,OAAO,IAAX;EACA,MAAI5H,cAAJ;EACA,MAAI0G,cAAJ;EACA,MAAI,CAACqG,UAAU,KAAK3G,EAAf,CAAL,EAAyB;EACzB,MAAI1D,IAAIqK,UAAU,KAAK3G,EAAf,EAAmBzD,MAA3B,EAAmC;EACjC3C,YAAQ+M,UAAU,KAAK3G,EAAf,EAAmB1D,CAAnB,CAAR;EACAgE,YAAQ,KAAK1G,KAAL,CAAR;;EAEA;EACA,QAAI0G,UAAU7C,SAAd,EAAyB6C,QAAQqB,eAAe/H,KAAf,CAAR;;EAEzB,QAAI0G,SAASsG,MAAMC,OAAN,CAAcvG,KAAd,CAAb,EAAmC;EACjC;EACA,UAAIwG,QAAQ,KAAKxG,MAAM,CAAN,CAAL,EAAeA,MAAM,CAAN,CAAf,CAAZ;;EAEA0C,aAAO+D,cAAP,CAAsB,KAAKzG,MAAM,CAAN,CAAL,CAAtB,EAAsCA,MAAM,CAAN,CAAtC,EAAgD;EAC9C0G,oBAAY,KADkC;EAE9CC,sBAAc,IAFgC;EAG9CC,aAAK,eAAY;EACf,iBAAOJ,KAAP;EACD,SAL6C;EAM9CK,aAAK,aAAU9I,GAAV,EAAe;EAClByI,kBAAQzI,GAAR;EACAiI,wBAAc3K,IAAd,CAAmB6F,IAAnB,EAAyB0E,OAAzB,EAAkCD,KAAlC;EACD;EAT6C,OAAhD;EAWD,KAfD,MAeO;EACL;EACAjD,aAAO+D,cAAP,CAAsB,IAAtB,EAA4BnN,KAA5B,EAAmC;EACjCoN,oBAAY,KADqB;EAEjCC,sBAAc,IAFmB;EAGjCC,aAAK,eAAY;EACf,iBAAO5G,KAAP;EACD,SALgC;EAMjC6G,aAAK,aAAU9I,GAAV,EAAe;EAClBiC,kBAAQjC,GAAR;EACAiI,wBAAc3K,IAAd,CAAmB6F,IAAnB,EAAyB0E,OAAzB,EAAkCD,KAAlC;EACD;EATgC,OAAnC;EAWD;EACD3J;EACAoK,cAAU/K,IAAV,CAAe,IAAf,EAAqBW,CAArB;EACD;EACF,CA5CD;;EA8CA,IAAM8K,WAAW,SAAXA,QAAW,GAAY;EAC3BV,YAAU/K,IAAV,CAAe,IAAf,EAAqB,CAArB;EACD,CAFD;;EAIA,IAAIgL,YAAY,EAAhB;;EAEA,SAASU,UAAT,GAAuB;EACrB,MAAIV,UAAU,KAAK3G,EAAf,CAAJ,EAAwB2G,UAAU,KAAK3G,EAAf,IAAqB,EAArB;EACzB;;EAED,SAASjF,QAAT,CAAmBnB,KAAnB,EAA0B;EACxB+M,YAAU,KAAK3G,EAAf,IAAqB2G,UAAU,KAAK3G,EAAf,KAAsB,EAA3C;EACA,MAAI2G,UAAU,KAAK3G,EAAf,EAAmB4C,OAAnB,CAA2BhJ,KAA3B,MAAsC,CAAC,CAA3C,EAA8C;EAAE+M,cAAU,KAAK3G,EAAf,IAAqB2G,UAAU,KAAK3G,EAAf,EAAmB7D,MAAnB,CAA0BvC,KAA1B,CAArB;EAAuD;EACxG;;EAED,IAAMuM,aAAa,SAAbA,UAAa,GAAY;EAC7B,OAAK9J,IAAL,GAAY,KAAKb,oBAAL,CAA0BE,SAA1B,CAAoC,IAApC,CAAZ;EACA;EACAwB,YAAUvB,IAAV,CAAe,IAAf,EAAqB,KAAKU,IAAL,CAAU3B,UAA/B,EAA2CK,SAAS0B,IAAT,CAAc,IAAd,CAA3C;EACA;EACAsJ,YAAUpK,IAAV,CAAe,IAAf,EAAqB,KAAKU,IAAL,CAAU3B,UAA/B;EACD,CAND;;EC9EA,IAAMX,0BAAwB,CAA9B;;AAEA,EAAe,mBAAUuN,IAAV,EAAgB;EAC7BlL,mBAAiBT,IAAjB,CAAsB,IAAtB,EAA4BZ,SAAS0B,IAAT,CAAc,IAAd,CAA5B;EACA;EACAS,YAAUvB,IAAV,CAAe,IAAf,EAAqB,KAAKU,IAAL,CAAU3B,UAA/B,EAA2CK,SAAS0B,IAAT,CAAc,IAAd,CAA3C;EACA;EACA,MAAM0D,KAAKmH,QAAQnJ,MAAM,KAAKgC,EAAX,CAAnB;EACA,MAAIA,EAAJ,EAAQ;EACN,QAAIA,GAAG5F,QAAH,KAAgBR,uBAApB,EAA2C;EACzCoG,SAAGxC,YAAH,CAAgB,aAAhB,EAA+B,EAA/B;EACD,KAFD,MAEO;EACLS,aAAO,KAAK/B,IAAL,CAAUU,UAAV,CAAqBR,MAArB,KAAgC,CAAvC,EAA0C,kDAA1C;EACA,OAAC,KAAKF,IAAL,CAAU3B,UAAV,CAAqB8H,YAArB,CAAkC,aAAlC,CAAD,IAAqD,KAAKnG,IAAL,CAAU3B,UAAV,CAAqBiD,YAArB,CAAkC,aAAlC,EAAiD,EAAjD,CAArD;EACD;EACD;EACAyJ,aAASzL,IAAT,CAAc,IAAd;EACA;EACA,QAAI,CAAC2L,IAAL,EAAW;EACTnH,SAAG1E,WAAH,CAAe,KAAKY,IAApB;EACD;;EAED;EACA,QAAI,KAAKkL,iBAAL,IAA0B,OAAO,KAAKA,iBAAZ,KAAkC,UAAhE,EAA4E;EAC1E,WAAKA,iBAAL;EACD;EACF,GAlBD,MAkBO;EACLnJ,WAAO,KAAP,EAAc,0BAA0B,KAAK+B,EAA/B,GAAoC,UAAlD;EACD;EACF;;EClCD;;;;;;;;;;;;;;;;;;;EAmBA;EACA,IAAMqH,WAAW,SAAXA,QAAW,CAAUxF,CAAV,EAAayF,CAAb,EAAgB;EAC/B,SAAOzF,EAAE,UAAF,MAAkByF,EAAE,UAAF,CAAzB;EACD,CAFD;;EAIA,IAAIC,QAAQ,EAAZ;;EAEA;EACA,IAAMC,SAAS,SAATA,MAAS,GAAmB;EAAA;;EAAA,oCAANlJ,IAAM;EAANA,QAAM;EAAA;;EAChC,MAAIiJ,MAAM,KAAKE,GAAX,CAAJ,EAAqBpB,aAAakB,MAAM,KAAKE,GAAX,CAAb;EACrBF,QAAM,KAAKE,GAAX,IAAkBnB,WAAW;EAAA,WAC3B,MAAKoB,IAAL,IAAa,OAAO,MAAKA,IAAZ,KAAqB,UAAlC,IAAgD,MAAKA,IAAL,CAAUC,KAAV,CAAgB,IAAhB,EAAsBrJ,IAAtB,CADrB;EAAA,GAAX,EAEd,CAFc,CAAlB;EAGD,CALD;;EAOA;;;;;;;;MAOqBsJ;EACnB,uBAAavK,eAAb,EAA8B;EAAA;;EAC5B,SAAKoK,GAAL,GAAW,KAAKI,SAAhB;;EAEAN,UAAM,KAAKE,GAAX,IAAkB,IAAlB;EACA;EACA;EACA,SAAKpK,eAAL,GAAuBA,mBAAmB,IAA1C;;EAEA,SAAKP,KAAL,GAAa,EAAb;;EAEA;EACA+F,WAAO+D,cAAP,CAAsB,IAAtB,EAA4B,MAA5B,EAAoC;EAClCC,kBAAY,KADsB;EAElCC,oBAAc,IAFoB;EAGlCC,WAAK,kBAAY;EACf,eAAO,KAAKjK,KAAZ;EACD,OALiC;EAMlCkK,WAAK,gBAAU9I,GAAV,EAAe;EAClB,aAAKpB,KAAL,GAAaoB,GAAb;EACA,aAAKX,KAAL,GAAa,IAAb;EACAiK,eAAOhM,IAAP,CAAY,IAAZ,EAAkB,KAAKsB,KAAvB,EAA8B,KAAKgL,UAAnC;EACD;EAViC,KAApC;;EAaA;EACAjF,WAAO+D,cAAP,CAAsB,IAAtB,EAA4B,YAA5B,EAA0C;EACxCC,kBAAY,KAD4B;EAExCC,oBAAc,IAF0B;EAGxCC,WAAK,kBAAY;EAAA;;EACf,eAAO,CAAC,KAAKgB,IAAN,GAAa,KAAKjL,KAAlB,GAA0B,KAAKA,KAAL,CAAWkL,MAAX,CAAkB;EAAA,iBAAOC,IAAI,OAAKF,IAAT,MAAmB,OAAK5H,KAA/B;EAAA,SAAlB,CAAjC;EACD;EALuC,KAA1C;EAOD;;EAED;;;EAKA;;;;;0BAKA+H,+BAAWjF,IAAI;EACb,SAAKyE,IAAL,GAAYzE,EAAZ;EACD;;EAED;;;;;;0BAIAkF,mBAAKF,KAAK;EACR,SAAK/K,IAAL,GAAY,KAAKA,IAAL,CAAUlB,MAAV,cAAsBiM,GAAtB,IAA2B,YAAYlK,OAAvC,IAAZ;EACD;;EAED;;;;;;0BAIAqK,yBAAQC,WAAW;EACjB,SAAKnL,IAAL,GAAY,KAAKA,IAAL,CAAU+B,GAAV,CAAc;EAAA,aACxBoI,SAASY,GAAT,EAAcI,SAAd,IAA2BJ,GAA3B,GAAiCI,SADT;EAAA,KAAd,CAAZ;EAGD;;EAED;;;;;;;;;0BAOAL,yBAAQD,MAAM5H,OAAO;EACnB,SAAK4H,IAAL,GAAYA,IAAZ;EACA,SAAK5H,KAAL,GAAaA,KAAb;EACA,SAAKjD,IAAL,GAAY,KAAKA,IAAjB;EACD;;EAED;;;;;;0BAIAoL,2BAASC,YAAY;EACnB,SAAKrL,IAAL,GAAY,KAAKA,IAAL,CAAU8K,MAAV,CAAiB,eAAO;EAClC,aAAOX,SAASY,GAAT,EAAcM,UAAd,CAAP;EACD,KAFW,CAAZ;EAGD;;;;6BApDuB;EACtB,aAAOxK,OAAP;EACD;;;;;EC9EH,IAAMyK,yBAAyB,EAA/B;EACA,IAAMC,qBAAqB,CAA3B;EACA,IAAM7O,0BAAwB,CAA9B;EACA;;;;;;;AAOA,EAAe,iBAAUsK,QAAV,EAAoB;EACjC,MAAIhI,aAAJ;EACA,MAAIwM,gBAAJ;EACA,MAAI3N,OAAOC,SAASC,sBAAT,EAAX;EACA;EACA;EACA,MAAI,OAAOiJ,QAAP,KAAoB,QAAxB,EAAkC;EAChChI,WAAOgI,SAASnI,IAAT,GAAgB4D,OAAhB,CAAwB,MAAxB,EAAgC,GAAhC,CAAP;EACA+I,cAAU1N,SAAS2N,aAAT,CAAuB,KAAvB,CAAV;EACAD,YAAQE,SAAR,GAAoB1M,IAApB;EACA,WAAOwM,QAAQnO,UAAf,EAA2B;EACzBQ,WAAKO,WAAL,CAAiBoN,QAAQnO,UAAzB;EACD;EACH;EACC,GARD,MAQO,IAAI,QAAO2J,QAAP,yCAAOA,QAAP,OAAoB,QAApB,IAAgCA,SAAS,UAAT,CAApC,EAA0D;EAC/D,QAAIA,SAAS,UAAT,MAAyBtK,uBAA7B,EAAoD;EAClDmB,WAAKO,WAAL,CAAiB4I,QAAjB;EACD,KAFD,MAEO,IAAIA,SAAS,UAAT,MAAyBsE,sBAA7B,EAAqD;EAC1DzN,aAAOmJ,QAAP;EACD,KAFM,MAEA,IAAIA,SAAS,UAAT,MAAyBuE,kBAA7B,EAAiD;EACtD1N,WAAKO,WAAL,CAAiB4I,QAAjB;EACD,KAFM,MAEA;EACLjG,aAAO,KAAP,EAAc,yCAAd;EACD;EACF,GAVM,MAUA;EACLA,WAAO,KAAP,EAAc,8CAAd;EACD;EACD;EACA,OAAK5C,oBAAL,GAA4BN,KAAKQ,SAAL,CAAe,IAAf,CAA5B;EACA,OAAKW,IAAL,GAAYnB,IAAZ;;EAEA;EACAmM,aAAW1L,IAAX,CAAgB,IAAhB;EACA,SAAO,IAAP;EACD;;EC9BD;EACA,SAASqN,SAAT,GAAqB;EACnBtJ,SAAOuJ,CAAP,GAAWC,QAAQC,GAAR,CAAY1M,IAAZ,CAAiByM,OAAjB,CAAX;EACAxJ,SAAO0J,EAAP,GAAYF,QAAQG,KAAR,CAAc5M,IAAd,CAAmByM,OAAnB,CAAZ;EACD;;EAEDF;;EAEA;;;;;MAIMM;EACJ,gBAAapH,IAAb,EAAmB;EAAA;;EACjB,SAAKlC,EAAL,GAAUsJ,KAAKtB,SAAf;EACA,QAAG9F,IAAH,EAAQ;EACN,WAAKqH,QAAL,CAAcrH,IAAd;EACD;EACF;;EAED;;;mBAKAsH,uBAAOnF,UAAU;EACf,WAAOmF,OAAM7N,IAAN,CAAW,IAAX,EAAiB0I,QAAjB,CAAP;EACD;;mBAEDoF,qBAAM7M,IAAI;EACR;EACA,QAAI,CAACA,EAAL,EAASwB,OAAOxB,EAAP,EAAW,8BAAX;EACT,SAAKuD,EAAL,GAAUvD,EAAV;EACA,SAAKqD,MAAL;EACA,WAAO,IAAP;EACD;;mBAEDA,yBAAQqH,MAAM;EACZ;EACA,QAAI,KAAKoC,kBAAL,IAA2B,OAAO,KAAKA,kBAAZ,KAAmC,UAAlE,EAA8E;EAC5E,WAAKA,kBAAL;EACD;;EAED;EACA,QAAIpC,IAAJ,EAAU;EACR,WAAKtB,OAAL,GAAe,IAAf;EACD;EACD2D,aAAShO,IAAT,CAAc,IAAd,EAAoB2L,IAApB;EACD;;mBAEDlH,qDAAuB;EACrB;EACA;EACAkG,kBAAc3K,IAAd,CAAmB,IAAnB,EAAyBuK,OAAzB,EAAkC,CAAlC;EACD;EACD;EACA;;;mBACAmC,+BAAWjF,IAAI;EACb,SAAKyE,IAAL,GAAYzE,EAAZ;EACD;EACD;EACA;;;mBACAuE,yBAAQ1K,OAAO;EACb,SAAK4K,IAAL,IAAa,OAAO,KAAKA,IAAZ,KAAqB,UAAlC,IAAgD,KAAKA,IAAL,CAAU5K,KAAV,CAAhD;EACD;;EAED;;;mBACAsM,6BAAUrH,MAAK;EACbxC,WAAOE,0BAAP,GAAoCF,OAAOE,0BAAP,IAAqC,EAAzE;EACA,QAAGF,OAAOE,0BAAP,CAAkCsC,IAAlC,CAAH,EAA4C;EAC1C9D,aAAO,KAAP,2BAAqC8D,IAArC;EACD,KAFD,MAEO;EACLxC,aAAOE,0BAAP,CAAkCsC,IAAlC,IAA0C,IAA1C;EACD;EACF;;;;6BArDuB;EACtB,aAAOrE,OAAP;EACD;;;;;;;;;;;;;;;"}